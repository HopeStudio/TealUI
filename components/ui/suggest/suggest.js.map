{"version":3,"file":"suggest.js","sources":["suggest.tsx"],"sourcesContent":["import * as dom from \"web/dom\";\r\nimport Control, { VNode, bind } from \"ui/control\";\r\nimport Picker from \"ui/picker\";\r\nimport ListBox, { ListItem } from \"ui/listBox\";\r\nimport Select from \"ui/select\";\r\nimport { getPinYinOfChar } from \"util/pinyin\";\r\n\r\n/**\r\n * 表示一个选择框。\r\n */\r\nexport default class Suggest extends Select {\r\n\r\n    validateEvent = \"blur\";\r\n\r\n    protected init() {\r\n        super.init();\r\n        this.input.readOnly = false;\r\n        dom.removeClass(this.elem, \"x-picker-select\");\r\n        dom.on(this.input, \"input\", this.handleInput, this);\r\n    }\r\n\r\n    protected handleInput() {\r\n        const value = this.input.value.trim();\r\n        let hasItem;\r\n        for (const item of this.menu.items) {\r\n            const val = !!value && !this.match(value, item.content);\r\n            if (!val) {\r\n                hasItem = true;\r\n            }\r\n            item.hidden = val;\r\n        }\r\n        this.dropDown.toggle(hasItem);\r\n        this.dropDown.realign();\r\n    }\r\n\r\n    private _cache = { __proto__: null };\r\n\r\n    match(value: string, item: string) {\r\n        value = value.toLowerCase();\r\n        let c = this._cache[item];\r\n        if (!c) {\r\n            c = this._cache[item] = {\r\n                lower: item.toLowerCase(),\r\n                pinyin: item.split(\"\").map(x => getPinYinOfChar(x).join(\"|\") || \"_\").join(\"\").toLowerCase(),\r\n                py: item.split(\"\").map(x => (getPinYinOfChar(x).join(\"|\") || \"_\")[0]).join(\"\").toLowerCase()\r\n            }\r\n        }\r\n\r\n        if (c.lower.indexOf(value) >= 0) {\r\n            return true;\r\n        }\r\n\r\n        if (c.pinyin.indexOf(value) >= 0) {\r\n            return true;\r\n        }\r\n\r\n        if (c.py.indexOf(value) >= 0) {\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * 是否允许自定义项。\r\n     */\r\n    allowCustom: boolean;\r\n\r\n    protected validate(value: this[\"value\"]) {\r\n        const b = super.validate(value);\r\n        if (b || this.allowCustom) {\r\n            return b;\r\n        }\r\n        if (this.menu.findItemByKey(value)) {\r\n            return \"\";\r\n        }\r\n        return \"请从菜单中选择项\";\r\n    }\r\n\r\n    get body() {\r\n        this.elem;\r\n        return this.menu.body;\r\n    }\r\n\r\n    get value() {\r\n        let c = this.input.value;\r\n        this.menu.items.forEach(item => {\r\n            if (item.body.textContent == this.input.value) {\r\n                c = item.key;\r\n            }\r\n        });\r\n        return c;\r\n    }\r\n    set value(value) {\r\n        this.menu.value = value;\r\n        this.input.value = this.menu.selectedItem ? this.menu.selectedItem.elem.textContent as string : value;\r\n    }\r\n\r\n}\r\n"],"mappings":"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"}