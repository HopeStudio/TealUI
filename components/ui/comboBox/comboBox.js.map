{"version":3,"file":"comboBox.js","sources":["comboBox.tsx"],"sourcesContent":["import * as dom from \"web/dom\";\r\nimport { scrollIntoViewIfNeeded } from \"web/scroll\";\r\nimport keyPress, { KeyPressOptions } from \"web/keyPress\";\r\nimport Control, { VNode, bind, from } from \"ui/control\";\r\nimport Picker from \"ui/picker\";\r\nimport ListBox, { ListItem, List } from \"ui/listBox\";\r\nimport \"typo/icon\";\r\n\r\n/**\r\n * 表示一个组合框。\r\n */\r\nexport default class ComboBox extends Picker {\r\n\r\n    menu: List;\r\n\r\n    value: string;\r\n\r\n    @bind(\"@menu\", \"items\") items: ListBox[\"items\"];\r\n\r\n    private _selectedItem: ListItem | null;\r\n\r\n    /**\r\n     * 选中的第一项。\r\n     */\r\n    get selectedItem() {\r\n        if (this._selectedItem && this._selectedItem.content === this.input.value) {\r\n            return this._selectedItem;\r\n        }\r\n        return this._selectedItem = this.menu.findItemByContent(this.input.value);\r\n    }\r\n    set selectedItem(value) {\r\n        this._selectedItem = value;\r\n        this.input.value = value ? value.content : \"\";\r\n    }\r\n\r\n    /**\r\n     * 选中的第一项的索引。\r\n     */\r\n    get selectedIndex() {\r\n        const item = this.selectedItem;\r\n        return item ? dom.index(item.elem) : -1;\r\n    }\r\n    set selectedIndex(value) {\r\n        this.selectedItem = value >= 0 ? this.items[value] : null;\r\n    }\r\n\r\n    protected createMenu(): Control {\r\n        const menu = new ListBox();\r\n        dom.on(menu.body, \"pointermove\", \"li\", (e, item) => {\r\n            this.menu.selectedItem = from(item) as ListItem;\r\n        });\r\n        menu.onSelect = (item, e) => {\r\n            if (e && (e as any).__ignore__) {\r\n                return;\r\n            }\r\n            this.handleMenuSelect(item, e);\r\n        };\r\n        return menu;\r\n    }\r\n\r\n    protected init() {\r\n        super.init();\r\n        keyPress(this.input, this.keyMappings);\r\n    }\r\n\r\n    get keyMappings(): KeyPressOptions {\r\n        const mappings = (this.menu as ListBox).keyMappings;\r\n        return {\r\n            up: (e) => {\r\n                if (this.dropDown.hidden) {\r\n                    this.dropDown.show();\r\n                } else {\r\n                    (e as any).__ignore__ = true;\r\n                    mappings.up!(e);\r\n                }\r\n            },\r\n            down: (e) => {\r\n                if (this.dropDown.hidden) {\r\n                    this.dropDown.show();\r\n                } else {\r\n                    (e as any).__ignore__ = true;\r\n                    mappings.down!(e);\r\n                }\r\n            },\r\n            enter: (e) => {\r\n                if (this.dropDown.hidden) {\r\n                    return false;\r\n                }\r\n                const item = this.menu.selectedItem;\r\n                if (item) (this.menu as ListBox).onSelect(item, e, this.menu as ListBox);\r\n            },\r\n            esc: () => {\r\n                if (this.dropDown.hidden) {\r\n                    return false;\r\n                }\r\n                this.dropDown.hide();\r\n            }\r\n        };\r\n    }\r\n\r\n    /**\r\n     * 选中项事件。\r\n     * @param item 当前选中的项。\r\n     * @param e 事件参数。\r\n     * @param sender 事件源。\r\n     */\r\n    onSelect: (item: ListItem, e: UIEvent, sender: this) => boolean | void;\r\n\r\n    /**\r\n     * 处理项选中事件。\r\n     * @param item 当前选中的项。\r\n     * @param e 事件参数。\r\n     */\r\n    protected handleMenuSelect(item: ListItem, e: UIEvent) {\r\n        if (this.onSelect && this.onSelect(item, e, this) === false) {\r\n            return;\r\n        }\r\n        this.dropDown.hide();\r\n        if (this.selectedItem !== item) {\r\n            this.selectedItem = item;\r\n            this.onChange && this.onChange(e, this);\r\n        }\r\n    }\r\n\r\n    protected updateMenu() {\r\n        const item = this.menu.selectedItem = this.selectedItem;\r\n        if (item) {\r\n            scrollIntoViewIfNeeded(item.elem, this.menu.body, this.duration);\r\n        }\r\n    }\r\n\r\n}\r\n"],"mappings":"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"}