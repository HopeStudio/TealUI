{"version":3,"file":"navMenu.js","sources":["navMenu.tsx"],"sourcesContent":["import * as dom from \"web/dom\";\r\nimport pin from \"web/pin\";\r\nimport Control, { VNode, bind } from \"ui/control\";\r\nimport \"typo/icon/icon.scss\";\r\nimport \"./navMenu.scss\";\r\nimport { scrollIntoViewIfNeeded } from \"web/scroll/scroll\";\r\nimport \"ui/popup\";\r\n\r\n/**\r\n * 表示一个导航菜单。\r\n */\r\nexport default class NavMenu extends Control {\r\n\r\n    protected render() {\r\n        return <nav class=\"x-navmenu\"></nav>;\r\n    }\r\n\r\n    protected init() {\r\n        dom.on(this.elem, \"click\", \"li\", this.handleItemClick, this);\r\n        dom.on(this.elem, \"pointerenter\", \">ul>li\", this.handleItemPointerEnter, this);\r\n        dom.on(this.elem, \"pointerleave\", \">ul>li\", this.handleItemPointerLeave, this);\r\n    }\r\n\r\n    /**\r\n     * 当前激活项。\r\n     */\r\n    get activeItem() {\r\n        return dom.find(this.elem, \".x-navmenu-active\");\r\n    }\r\n    set activeItem(value) {\r\n        dom.query(this.elem, \".x-navmenu-active\").forEach(elem => {\r\n            dom.removeClass(elem, \"x-navmenu-active\");\r\n        });\r\n        if (value) {\r\n            dom.addClass(value, \"x-navmenu-active\");\r\n            if (!this.collapsed) {\r\n                dom.show(dom.last(value)!);\r\n            }\r\n\r\n            for (let p = value; (p = p.parentNode as HTMLElement);) {\r\n                if (dom.hasClass(p, \"x-navmenu-collapsable\")) {\r\n                    dom.removeClass(p, \"x-navmenu-collapsed\");\r\n                    dom.addClass(p, \"x-navmenu-active\");\r\n                    if (!this.collapsed) {\r\n                        dom.show(dom.last(p)!);\r\n                    }\r\n                }\r\n            }\r\n            scrollIntoViewIfNeeded(value, undefined, this.duration);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 点击项事件。\r\n     */\r\n    protected handleItemClick(e: MouseEvent, item: HTMLElement) {\r\n        this.activeItem = item;\r\n        if (dom.hasClass(item, \"x-navmenu-collapsable\")) {\r\n            if ((!this.collapsed || item.parentNode!.parentNode !== this.elem)) {\r\n                const collapse = !dom.hasClass(item, \"x-navmenu-collapsed\");\r\n                dom.toggle(dom.last(item)!, !collapse, \"height\", undefined, this.duration);\r\n                dom.toggleClass(item, \"x-navmenu-collapsed\", collapse);\r\n            }\r\n        }\r\n\r\n        if (this.onItemClick) {\r\n            this.onItemClick(item, e);\r\n        }\r\n        if (this.collapsed) {\r\n            const popover = this.find(\".x-navmenu-popover\") as HTMLElement;\r\n            if (popover) {\r\n                this.handleItemPointerLeave(e, this.activeItem = popover.parentNode as HTMLElement);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 是否显示折叠模式。\r\n     */\r\n    @bind(\"\", \"class\", \"x-navmenu-mini\") collapsed: boolean;\r\n\r\n    /**\r\n     * 项点击事件。\r\n     */\r\n    onItemClick: (item: HTMLElement, e: MouseEvent) => void;\r\n\r\n    onCollapseChange: () => void;\r\n\r\n    toggleCollapse() {\r\n        const show = this.collapsed;\r\n        if (show) {\r\n            const width = this.elem.offsetWidth;\r\n            this.collapsed = false;\r\n            const newWidth = this.elem.offsetWidth;\r\n            dom.setStyle(this.elem, \"width\", width);\r\n            dom.animate(this.elem, { width: newWidth }, () => {\r\n                dom.setStyle(this.elem, \"width\", \"\");\r\n            }, this.duration);\r\n        } else {\r\n            this.collapsed = true;\r\n            const width = this.elem.offsetWidth;\r\n            this.collapsed = false;\r\n            dom.animate(this.elem, { width: width }, () => {\r\n                dom.setStyle(this.elem, \"width\", \"\");\r\n                this.collapsed = true;\r\n            }, this.duration);\r\n        }\r\n        dom.query(this.elem, \".x-navmenu-collapsable:not(.x-navmenu-collapsed)>ul\").forEach(item => {\r\n            dom.toggle(item, show, \"height\", () => {\r\n                item.style.display = \"\";\r\n            }, this.duration);\r\n        });\r\n        this.onCollapseChange && this.onCollapseChange();\r\n    }\r\n\r\n    /**\r\n     * 鼠标移入折叠项事件。\r\n     */\r\n    protected handleItemPointerEnter(e: MouseEvent, item: HTMLElement) {\r\n        if (this.collapsed) {\r\n            this.activeItem = item;\r\n            if (dom.hasClass(item, \"x-navmenu-collapsable\")) {\r\n                const ul = dom.last(item)! as HTMLElement;\r\n                dom.addClass(ul, \"x-navmenu-popover\");\r\n                dom.addClass(ul, \"x-popup\");\r\n                dom.show(ul, \"opacity\", undefined, this.duration);\r\n                pin(ul, dom.first(item)!, \"rightTop\", 1, document);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 鼠标移出折叠项事件。\r\n     */\r\n    protected handleItemPointerLeave(e: MouseEvent, item: HTMLElement) {\r\n        if (this.collapsed && dom.hasClass(item, \"x-navmenu-collapsable\")) {\r\n            const ul = dom.last(item)!;\r\n            dom.hide(ul, \"opacity\", () => {\r\n                dom.removeClass(ul, \"x-navmenu-popover\");\r\n                dom.removeClass(ul, \"x-popup\");\r\n            }, this.duration);\r\n        }\r\n    }\r\n\r\n}\r\n"],"mappings":"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"}