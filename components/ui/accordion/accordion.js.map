{"version":3,"file":"accordion.js","sources":["accordion.tsx"],"sourcesContent":["import * as dom from \"web/dom\";\r\nimport Control, { VNode, bind } from \"ui/control\";\r\nimport Panel from \"ui/panel\";\r\nimport \"./accordion.scss\";\r\n\r\n/**\r\n * 表示一个手风琴。\r\n */\r\nexport default class Accordion extends Control {\r\n\r\n    /**\r\n     * 是否允许同时开多个面板。\r\n     */\r\n    multiply: boolean;\r\n\r\n    /**\r\n     * 切换折叠事件。\r\n     * @param panel 当前展开的面板。\r\n     * @param sender 事件源。\r\n     */\r\n    onCollapseChange: (panel: Panel, sender: this) => void;\r\n\r\n    /**\r\n     * 选中的索引。\r\n     */\r\n    get selectedIndex() { return this.panels.findIndex(panel => !panel.collapsed); }\r\n    set selectedIndex(value) {\r\n        this.panels.forEach((panel, index) => {\r\n            panel.collapsed = index !== value;\r\n        });\r\n    }\r\n\r\n    protected render() {\r\n        return <div class=\"x-accordion\"></div>;\r\n    }\r\n\r\n    /**\r\n     * 获取所有面板。\r\n     */\r\n    get panels() { return this.query(\">.x-panel\") as any[] as Panel[]; }\r\n\r\n    layout() {\r\n        let selectedIndex = this.selectedIndex;\r\n        if (selectedIndex < 0) selectedIndex = 0;\r\n        this.panels.forEach((panel, index) => {\r\n            panel.collapsable = true;\r\n            panel.onCollapseChange = this.handlePanelBeforeCollapseChange;\r\n            if (!this.multiply) {\r\n                panel.collapsed = index !== selectedIndex;\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 标记是否正在处理折叠事件。\r\n     */\r\n    private _ignoreChange: boolean;\r\n\r\n    /**\r\n     * 处理面板即将折叠事件。\r\n     * @param value 如果为 true 表示即将折叠。\r\n     * @param sender 事件源。\r\n     */\r\n    protected handlePanelBeforeCollapseChange = (value: boolean, sender: Panel) => {\r\n        if (this._ignoreChange) {\r\n            return;\r\n        }\r\n        if (!this.multiply) {\r\n            const selectedIndex = this.selectedIndex;\r\n            if (selectedIndex < 0) {\r\n                return;\r\n            }\r\n            if (this.panels[selectedIndex] !== sender) {\r\n                this._ignoreChange = true;\r\n                this.panels[selectedIndex].toggleCollapse(true);\r\n                this._ignoreChange = false;\r\n            } else if (value) {\r\n                return false;\r\n            }\r\n            this.selectedIndex = this.panels.indexOf(sender);\r\n        }\r\n        this.onCollapseChange && this.onCollapseChange(sender, this);\r\n    }\r\n\r\n}\r\n"],"mappings":";;;;;;;;;;;;;IAKA;;OAEG;IACH;QAAuC,6BAAO;QAA9C;YAAA,qEA4EC;YA1BG;;;;eAIG;YACO,qCAA+B,GAAG,UAAC,KAAc,EAAE,MAAa;gBACtE,EAAE,CAAC,CAAC,KAAI,CAAC,aAAa,CAAC,CAAC,CAAC;oBACrB,MAAM,CAAC;gBACX,CAAC;gBACD,EAAE,CAAC,CAAC,CAAC,KAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;oBACjB,IAAM,aAAa,GAAG,KAAI,CAAC,aAAa,CAAC;oBACzC,EAAE,CAAC,CAAC,aAAa,GAAG,CAAC,CAAC,CAAC,CAAC;wBACpB,MAAM,CAAC;oBACX,CAAC;oBACD,EAAE,CAAC,CAAC,KAAI,CAAC,MAAM,CAAC,aAAa,CAAC,KAAK,MAAM,CAAC,CAAC,CAAC;wBACxC,KAAI,CAAC,aAAa,GAAG,IAAI,CAAC;wBAC1B,KAAI,CAAC,MAAM,CAAC,aAAa,CAAC,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC;wBAChD,KAAI,CAAC,aAAa,GAAG,KAAK,CAAC;oBAC/B,CAAC;oBAAC,IAAI,CAAC,EAAE,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC;wBACf,MAAM,CAAC,KAAK,CAAC;oBACjB,CAAC;oBACD,KAAI,CAAC,aAAa,GAAG,KAAI,CAAC,MAAM,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;gBACrD,CAAC;gBACD,KAAI,CAAC,gBAAgB,IAAI,KAAI,CAAC,gBAAgB,CAAC,MAAM,EAAE,KAAI,CAAC,CAAC;YACjE,CAAC,CAAA;;QAEL,CAAC;QA3DG,sBAAI,oCAAa;YAHjB;;eAEG;iBACH,cAAsB,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,UAAA,KAAK,IAAI,OAAA,CAAC,KAAK,CAAC,SAAS,EAAhB,CAAgB,CAAC,CAAC,CAAC,CAAC;iBAChF,UAAkB,KAAK;gBACnB,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,UAAC,KAAK,EAAE,KAAK;oBAC7B,KAAK,CAAC,SAAS,GAAG,KAAK,KAAK,KAAK,CAAC;gBACtC,CAAC,CAAC,CAAC;YACP,CAAC;;;WAL+E;QAOtE,0BAAM,GAAhB;YACI,MAAM,CAAC,gCAAK,KAAK,EAAC,aAAa,GAAO,CAAC;QAC3C,CAAC;QAKD,sBAAI,6BAAM;YAHV;;eAEG;iBACH,cAAe,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,WAAW,CAAqB,CAAC,CAAC,CAAC;;;WAAA;QAEpE,0BAAM,GAAN;YAAA,iBAUC;YATG,IAAI,aAAa,GAAG,IAAI,CAAC,aAAa,CAAC;YACvC,EAAE,CAAC,CAAC,aAAa,GAAG,CAAC,CAAC;gBAAC,aAAa,GAAG,CAAC,CAAC;YACzC,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,UAAC,KAAK,EAAE,KAAK;gBAC7B,KAAK,CAAC,WAAW,GAAG,IAAI,CAAC;gBACzB,KAAK,CAAC,gBAAgB,GAAG,KAAI,CAAC,+BAA+B,CAAC;gBAC9D,EAAE,CAAC,CAAC,CAAC,KAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;oBACjB,KAAK,CAAC,SAAS,GAAG,KAAK,KAAK,aAAa,CAAC;gBAC9C,CAAC;YACL,CAAC,CAAC,CAAC;QACP,CAAC;QAiCL,gBAAC;IAAD,CAAC,AA5ED,CAAuC,iBAAO,GA4E7C"}