{"version":3,"file":"dialog.js","sources":["dialog.tsx"],"sourcesContent":["import * as dom from \"web/dom\";\r\nimport draggable, { Draggable } from \"web/draggable\";\r\nimport Control, { bind, VNode, NodeLike } from \"ui/control\";\r\nimport \"typo/icon\";\r\nimport \"typo/close\";\r\nimport \"ui/panel\";\r\nimport \"./dialog.scss\";\r\n\r\n/**\r\n * 表示一个对话框。\r\n */\r\nexport default class Dialog extends Control {\r\n\r\n    protected render() {\r\n        return <div class=\"x-dialog\" style=\"display: none\">\r\n            <section class=\"x-panel\">\r\n                <header class=\"x-panel-header\">\r\n                    <button class=\"x-close x-icon\" title=\"关闭\" aria-label=\"关闭\">✖</button>\r\n                    <h5></h5>\r\n                </header>\r\n                <div class=\"x-panel-body\">\r\n                </div>\r\n            </section>\r\n        </div>;\r\n    }\r\n\r\n    /**\r\n     * 头部。\r\n     */\r\n    @bind(\".x-panel-header\") header: HTMLElement;\r\n\r\n    /**\r\n     * 标题。\r\n     */\r\n    @bind(\".x-panel-header h5\", \"innerHTML\") title: NodeLike;\r\n\r\n    /**\r\n     * 是否可关闭。\r\n     */\r\n    @bind(\".x-panel-header .x-close\", \"hidden\") hideClose: boolean;\r\n\r\n    @bind(\".x-panel-body\") body: HTMLElement;\r\n\r\n    protected init() {\r\n        const close = dom.find(this.header, \".x-close\");\r\n        if (close) {\r\n            dom.on(close, \"click\", this.handleCloseClick, this);\r\n        }\r\n        this.draggable = true;\r\n    }\r\n\r\n    /**\r\n     * 当点击关闭按钮后执行。\r\n     */\r\n    protected handleCloseClick() {\r\n        this.close();\r\n    }\r\n\r\n    /**\r\n     * 切换显示的动画。\r\n     */\r\n    animation: dom.ToggleAnimation;\r\n\r\n    /**\r\n     * 切换显示的动画目标。\r\n     */\r\n    target?: HTMLElement;\r\n\r\n    /**\r\n     * 显示当前对话框。\r\n     * @param target 显示的目标。\r\n     */\r\n    show(target?: HTMLElement) {\r\n        if (target) {\r\n            this.target = target;\r\n        } else {\r\n            target = this.target;\r\n        }\r\n        dom.ready(() => {\r\n            if (!dom.contains(document.body, this.elem)) {\r\n                document.body.appendChild(this.elem);\r\n            }\r\n            if (this.hidden) {\r\n                dom.show(this.elem);\r\n                dom.show(this.find(\".x-panel\") as HTMLElement, this.animation, undefined, this.duration, undefined, target);\r\n                dom.addClass(document.body, \"x-dialog-open\");\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 关闭当前对话框。\r\n     * @param target 关闭的目标。\r\n     */\r\n    close(target?: HTMLElement) {\r\n        if (target) {\r\n            this.target = target;\r\n        } else {\r\n            target = this.target;\r\n        }\r\n        if (!this.onBeforeClose || this.onBeforeClose() !== false) {\r\n            this.elem.style.backgroundColor = \"transparent\";\r\n            dom.hide(this.find(\".x-panel\") as HTMLElement, this.animation, () => {\r\n                this.elem.style.backgroundColor = \"\";\r\n                dom.removeClass(document.body, \"x-dialog-open\");\r\n                this.renderTo(null);\r\n                this.onClose && this.onClose();\r\n            }, this.duration, undefined, target);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 即将关闭对话框事件。\r\n     */\r\n    onBeforeClose: () => boolean | void;\r\n\r\n    /**\r\n     * 关闭对话框事件。\r\n     */\r\n    onClose: () => void;\r\n\r\n    private _draggable: Draggable;\r\n\r\n    /**\r\n     * 是否可拖动。\r\n     */\r\n    get draggable() {\r\n        return !!this._draggable;\r\n    }\r\n    set draggable(value) {\r\n        dom.toggleClass(this.elem, \"x-dialog-draggable\", value);\r\n        if (value) {\r\n            if (this._draggable) {\r\n                this._draggable.enable();\r\n            } else {\r\n                this._draggable = draggable(this.find(\".x-panel-header h5\") as HTMLElement, {\r\n                    proxy: this.find(\".x-panel\") as HTMLElement,\r\n                    onDragStart: () => {\r\n                        if (!this._draggable.proxy.style.margin) {\r\n                            const rect = dom.getRect(this._draggable.proxy);\r\n                            this._draggable.proxy.style.margin = \"0\";\r\n                            dom.setRect(this._draggable.proxy, rect);\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n        } else if (this._draggable) {\r\n            this._draggable.disable();\r\n        }\r\n    }\r\n\r\n}\r\n\r\nDialog.prototype.animation = \"scale\";\r\n"],"mappings":"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"}