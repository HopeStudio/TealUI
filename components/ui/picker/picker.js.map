{"version":3,"file":"picker.js","sources":["picker.tsx"],"sourcesContent":["import * as dom from \"web/dom\";\r\nimport Control, { VNode, bind } from \"ui/control\";\r\nimport Input from \"ui/input\";\r\nimport { Popup } from \"web/popup\";\r\nimport { Status, getStatus, setStatus } from \"web/status\";\r\nimport TextBox from \"ui/textBox\";\r\nimport \"ui/button/button.scss\";\r\nimport \"./picker.scss\";\r\n\r\n/**\r\n * 表示一个填选器。\r\n */\r\nexport default class Picker extends TextBox {\r\n\r\n    protected render(): VNode {\r\n        return <span class=\"x-picker\">\r\n            <input type=\"text\" class=\"x-textbox\" autocomplete=\"off\" __control__={this} />\r\n            <button type=\"button\" class=\"x-button\" tabIndex={-1}><i class=\"x-icon\">⮟</i></button>\r\n        </span>;\r\n    }\r\n\r\n    value: any;\r\n\r\n    /**\r\n     * 按钮。\r\n     */\r\n    @bind(\".x-button\") button: HTMLButtonElement;\r\n\r\n    /**\r\n     * 图标。\r\n     */\r\n    @bind(\".x-button .x-icon\", \"innerHTML\") icon: string;\r\n\r\n    get disabled() {\r\n        return this.input.disabled && this.button.disabled;\r\n    }\r\n    set disabled(value) {\r\n        this.button.disabled = this.input.disabled = value;\r\n    }\r\n\r\n    get readOnly() {\r\n        return this.input.readOnly && this.button.disabled;\r\n    }\r\n    set readOnly(value) {\r\n        this.button.disabled = this.input.readOnly = value;\r\n    }\r\n\r\n    /**\r\n     * 存储下拉菜单控件。\r\n     */\r\n    private _menu: Control;\r\n\r\n    /**\r\n     * 下拉菜单控件。\r\n     */\r\n    get menu() {\r\n        let menu = this._menu;\r\n        if (!menu) {\r\n            this._menu = menu = this.createMenu();\r\n            menu.renderTo(this.elem);\r\n            dom.addClass(menu.elem, \"x-popup\");\r\n            Object.assign(menu, this.menuOptions);\r\n            if (this.resizeMode === \"fitDropDown\") {\r\n                dom.show(menu.elem);\r\n                dom.setRect(this.elem, { width: dom.getRect(menu.elem).width });\r\n            }\r\n            dom.hide(menu.elem);\r\n        }\r\n        return this._menu;\r\n    }\r\n\r\n    /**\r\n     * 当被子类重写时负责创建下拉菜单。\r\n     * @return 返回下拉菜单。\r\n     */\r\n    protected createMenu() {\r\n        return new Control();\r\n    }\r\n\r\n    /**\r\n     * 当被子类重写时负责更新下拉菜单的值。\r\n     */\r\n    protected updateMenu() { }\r\n\r\n    /**\r\n     * 下拉菜单控件的选项。\r\n     */\r\n    menuOptions: Partial<this[\"menu\"]>;\r\n\r\n    /**\r\n     * 下拉框大小模式。\r\n     * - auto（默认）: 确保下拉菜单比文本框宽度大。\r\n     * - fitInput: 下拉菜单适应文本框宽度。\r\n     * - fitDropDown: 文本框适应下拉菜单宽度。\r\n     */\r\n    resizeMode: \"auto\" | \"fitInput\" | \"fitDropDown\";\r\n\r\n    get body() { return this.menu.body; }\r\n\r\n    /**\r\n     * 存储下拉菜单。\r\n     */\r\n    private _dropDown: Popup;\r\n\r\n    /**\r\n     * 下拉菜单。\r\n     */\r\n    get dropDown() {\r\n        let dropDown = this._dropDown;\r\n        if (!dropDown) {\r\n            this._dropDown = dropDown = this.createDropDown();\r\n            Object.assign(dropDown, this.dropDownOptions);\r\n        }\r\n        return dropDown;\r\n    }\r\n\r\n    /**\r\n     * 当被子类重写时负责创建下拉菜单。\r\n     * @return 返回下拉菜单。\r\n     */\r\n    protected createDropDown() {\r\n        const dropDown = new Popup();\r\n        dropDown.elem = this.menu.elem;\r\n        dropDown.target = this.input;\r\n        dropDown.pinTarget = this.elem;\r\n        dropDown.align = \"bottomLeft\";\r\n        dropDown.event = \"focusin\";\r\n        dropDown.animation = \"scaleY\";\r\n        dropDown.onShow = () => { this.handleDropDownShow(); };\r\n        dropDown.onHide = () => { this.handleDropDownHide(); };\r\n        return dropDown;\r\n    }\r\n\r\n    /**\r\n     * 下拉菜单的选项。\r\n     */\r\n    dropDownOptions: Partial<Popup>;\r\n\r\n    /**\r\n     * 下拉菜单显示事件。\r\n     * @param sender 事件源。\r\n     */\r\n    onDropDownShow: (sender: this) => void;\r\n\r\n    /**\r\n     * 下拉菜单隐藏事件。\r\n     * @param sender 事件源。\r\n     */\r\n    onDropDownHide: (sender: this) => void;\r\n\r\n    protected init() {\r\n        super.init();\r\n\r\n        // 初始化下拉效果。\r\n        this.dropDown.enable();\r\n\r\n        // 初始化按钮。\r\n        dom.on(this.button, \"click\", this.handleButtonClick, this);\r\n        dom.on(this.input, \"input\", this.handleInput, this);\r\n    }\r\n\r\n    /**\r\n     * 处理下拉菜单显示事件。\r\n     */\r\n    protected handleDropDownShow() {\r\n        if (this.disabled || this.readOnly) {\r\n            this.dropDown.hide();\r\n            return;\r\n        }\r\n        this.updateMenu();\r\n        if (this.resizeMode !== \"fitDropDown\") {\r\n            const elemWidth = dom.getRect(this.elem).width;\r\n            if (this.resizeMode === \"fitInput\" || dom.getRect(this.dropDown.elem).width < elemWidth) {\r\n                dom.setRect(this.dropDown.elem, { width: elemWidth });\r\n            }\r\n        }\r\n        this.onDropDownShow && this.onDropDownShow(this);\r\n    }\r\n\r\n    /**\r\n     * 处理按钮点击事件。\r\n     */\r\n    protected handleButtonClick() {\r\n        this.input.select();\r\n    }\r\n\r\n    /**\r\n     * 处理下拉菜单隐藏事件。\r\n     */\r\n    protected handleDropDownHide() {\r\n        this.onDropDownHide && this.onDropDownHide(this);\r\n    }\r\n\r\n    /**\r\n     * 处理输入事件。\r\n     */\r\n    protected handleInput() {\r\n        if (!this.dropDown.hidden) {\r\n            this.updateMenu();\r\n        }\r\n    }\r\n\r\n}\r\n\r\nPicker.prototype.resizeMode = \"auto\";\r\n"],"mappings":";;;;;;;;;;;;;;;;;;IASA;;OAEG;IACH;QAAoC,0BAAO;QAA3C;;QA8LA,CAAC;QA5La,uBAAM,GAAhB;YACI,MAAM,CAAC,iCAAM,KAAK,EAAC,UAAU;gBACzB,kCAAO,IAAI,EAAC,MAAM,EAAC,KAAK,EAAC,WAAW,EAAC,YAAY,EAAC,KAAK,EAAC,WAAW,EAAE,IAAI,GAAI;gBAC7E,mCAAQ,IAAI,EAAC,QAAQ,EAAC,KAAK,EAAC,UAAU,EAAC,QAAQ,EAAE,CAAC,CAAC;oBAAE,8BAAG,KAAK,EAAC,QAAQ,aAAM,CAAS,CAClF,CAAC;QACZ,CAAC;QAcD,sBAAI,4BAAQ;iBAAZ;gBACI,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,QAAQ,IAAI,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC;YACvD,CAAC;iBACD,UAAa,KAAK;gBACd,IAAI,CAAC,MAAM,CAAC,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,GAAG,KAAK,CAAC;YACvD,CAAC;;;WAHA;QAKD,sBAAI,4BAAQ;iBAAZ;gBACI,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,QAAQ,IAAI,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC;YACvD,CAAC;iBACD,UAAa,KAAK;gBACd,IAAI,CAAC,MAAM,CAAC,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,GAAG,KAAK,CAAC;YACvD,CAAC;;;WAHA;QAaD,sBAAI,wBAAI;YAHR;;eAEG;iBACH;gBACI,IAAI,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC;gBACtB,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;oBACR,IAAI,CAAC,KAAK,GAAG,IAAI,GAAG,IAAI,CAAC,UAAU,EAAE,CAAC;oBACtC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;oBACzB,GAAG,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC;oBACnC,MAAM,CAAC,MAAM,CAAC,IAAI,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;oBACtC,EAAE,CAAC,CAAC,IAAI,CAAC,UAAU,KAAK,aAAa,CAAC,CAAC,CAAC;wBACpC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;wBACpB,GAAG,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,EAAE,EAAE,KAAK,EAAE,GAAG,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,KAAK,EAAE,CAAC,CAAC;oBACpE,CAAC;oBACD,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBACxB,CAAC;gBACD,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC;YACtB,CAAC;;;WAAA;QAED;;;WAGG;QACO,2BAAU,GAApB;YACI,MAAM,CAAC,IAAI,iBAAO,EAAE,CAAC;QACzB,CAAC;QAED;;WAEG;QACO,2BAAU,GAApB,cAAyB,CAAC;QAe1B,sBAAI,wBAAI;iBAAR,cAAa,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;;;WAAA;QAUrC,sBAAI,4BAAQ;YAHZ;;eAEG;iBACH;gBACI,IAAI,QAAQ,GAAG,IAAI,CAAC,SAAS,CAAC;gBAC9B,EAAE,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;oBACZ,IAAI,CAAC,SAAS,GAAG,QAAQ,GAAG,IAAI,CAAC,cAAc,EAAE,CAAC;oBAClD,MAAM,CAAC,MAAM,CAAC,QAAQ,EAAE,IAAI,CAAC,eAAe,CAAC,CAAC;gBAClD,CAAC;gBACD,MAAM,CAAC,QAAQ,CAAC;YACpB,CAAC;;;WAAA;QAED;;;WAGG;QACO,+BAAc,GAAxB;YAAA,iBAWC;YAVG,IAAM,QAAQ,GAAG,IAAI,aAAK,EAAE,CAAC;YAC7B,QAAQ,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC;YAC/B,QAAQ,CAAC,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC;YAC7B,QAAQ,CAAC,SAAS,GAAG,IAAI,CAAC,IAAI,CAAC;YAC/B,QAAQ,CAAC,KAAK,GAAG,YAAY,CAAC;YAC9B,QAAQ,CAAC,KAAK,GAAG,SAAS,CAAC;YAC3B,QAAQ,CAAC,SAAS,GAAG,QAAQ,CAAC;YAC9B,QAAQ,CAAC,MAAM,GAAG,cAAQ,KAAI,CAAC,kBAAkB,EAAE,CAAC,CAAC,CAAC,CAAC;YACvD,QAAQ,CAAC,MAAM,GAAG,cAAQ,KAAI,CAAC,kBAAkB,EAAE,CAAC,CAAC,CAAC,CAAC;YACvD,MAAM,CAAC,QAAQ,CAAC;QACpB,CAAC;QAmBS,qBAAI,GAAd;YACI,iBAAM,IAAI,WAAE,CAAC;YAEb,WAAW;YACX,IAAI,CAAC,QAAQ,CAAC,MAAM,EAAE,CAAC;YAEvB,SAAS;YACT,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,MAAM,EAAE,OAAO,EAAE,IAAI,CAAC,iBAAiB,EAAE,IAAI,CAAC,CAAC;YAC3D,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,KAAK,EAAE,OAAO,EAAE,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC;QACxD,CAAC;QAED;;WAEG;QACO,mCAAkB,GAA5B;YACI,EAAE,CAAC,CAAC,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;gBACjC,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC;gBACrB,MAAM,CAAC;YACX,CAAC;YACD,IAAI,CAAC,UAAU,EAAE,CAAC;YAClB,EAAE,CAAC,CAAC,IAAI,CAAC,UAAU,KAAK,aAAa,CAAC,CAAC,CAAC;gBACpC,IAAM,SAAS,GAAG,GAAG,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,KAAK,CAAC;gBAC/C,EAAE,CAAC,CAAC,IAAI,CAAC,UAAU,KAAK,UAAU,IAAI,GAAG,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,KAAK,GAAG,SAAS,CAAC,CAAC,CAAC;oBACtF,GAAG,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,EAAE,KAAK,EAAE,SAAS,EAAE,CAAC,CAAC;gBAC1D,CAAC;YACL,CAAC;YACD,IAAI,CAAC,cAAc,IAAI,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC;QACrD,CAAC;QAED;;WAEG;QACO,kCAAiB,GAA3B;YACI,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC;QACxB,CAAC;QAED;;WAEG;QACO,mCAAkB,GAA5B;YACI,IAAI,CAAC,cAAc,IAAI,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC;QACrD,CAAC;QAED;;WAEG;QACO,4BAAW,GAArB;YACI,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC;gBACxB,IAAI,CAAC,UAAU,EAAE,CAAC;YACtB,CAAC;QACL,CAAC;QA9KkB;YAAlB,cAAI,CAAC,WAAW,CAAC;8CAA2B;QAKL;YAAvC,cAAI,CAAC,mBAAmB,EAAE,WAAW,CAAC;4CAAc;QA2KzD,aAAC;KAAA,AA9LD,CAAoC,iBAAO,GA8L1C;sBA9LoB,MAAM;IAgM3B,MAAM,CAAC,SAAS,CAAC,UAAU,GAAG,MAAM,CAAC"}