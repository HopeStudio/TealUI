{"version":3,"file":"draggable.js","sources":["draggable.ts"],"sourcesContent":["import { movable, getOffset, Rect, getRect, animate } from \"web/dom\";\r\nimport { Movable } from \"web/movable\";\r\nimport { scrollIntoViewIfNeeded } from \"web/scroll\";\r\n\r\n/**\r\n * 设置指定的元素可拖动。\r\n * @param elem 要拖动的元素。\r\n * @param options 拖动的选项。\r\n * @return 返回一个拖动对象。\r\n */\r\nexport default function draggable(elem: HTMLElement, options?: Partial<Draggable>) {\r\n    let r = (elem as any).__draggable__ as  Draggable;\r\n    if(!r) {\r\n        ((elem as any).__draggable__ = r = new Draggable());\r\n        r.proxy = r.elem = elem;\r\n    }\r\n    Object.assign(r, options).enable();\r\n    movable(r.proxy);\r\n    return r;\r\n}\r\n\r\n/**\r\n * 表示一个可拖动对象。\r\n */\r\nexport class Draggable extends Movable {\r\n\r\n    /**\r\n     * 从指针按下到触发移动事件的等待毫秒数。如果为 -1 则忽略指针按下不动的操作。\r\n     * @default 500\r\n     */\r\n    delay: number;\r\n\r\n    /**\r\n     * 实际移动的元素。\r\n     */\r\n    proxy: HTMLElement;\r\n\r\n    /**\r\n     * 拖动开始事件。\r\n     * @param e 事件对象。\r\n     * @param sender 事件源。\r\n     * @return 如果返回 false 则忽略本次拖动。\r\n     */\r\n    onDragStart?: (e: MouseEvent, sender: this) => boolean | void;\r\n\r\n    /**\r\n     * 拖动移动事件。\r\n     * @param e 事件对象。\r\n     * @param sender 事件源。\r\n     * @return 如果返回 false 则不更改元素的位置。\r\n     */\r\n    onDragMove?: (e: MouseEvent, sender: this) => boolean | void;\r\n\r\n    /**\r\n     * 拖动结束事件。\r\n     * @param e 事件对象。\r\n     * @param sender 事件源。\r\n     */\r\n    onDragEnd?: (e: MouseEvent, sender: this) => void;\r\n\r\n    /**\r\n     * 拖动取消事件。\r\n     * @param e 事件对象。\r\n     * @param sender 事件源。\r\n     */\r\n    onDragCancel?: (e: MouseEvent, sender: this) => void;\r\n\r\n    /**\r\n     * 开始拖动时拖动元素的水平偏移距离（单位：像素）。\r\n     */\r\n    startClientX: number;\r\n\r\n    /**\r\n     * 开始拖动时拖动元素的垂直偏移距离（单位：像素）。\r\n     */\r\n    startClientY: number;\r\n\r\n    /**\r\n     * 当前拖动元素的水平偏移距离（单位：像素）。\r\n     */\r\n    endClientX: number;\r\n\r\n    /**\r\n     * 当前拖动元素的垂直偏移距离（单位：像素）。\r\n     */\r\n    endClientY: number;\r\n\r\n    /**\r\n     * 触发拖动开始事件。\r\n     * @param e 事件对象。\r\n     * @return 如果返回 false 则忽略本次拖动。\r\n     */\r\n    moveStart(e: MouseEvent) {\r\n        if (this.onDragStart && this.onDragStart(e, this) === false) {\r\n            return false;\r\n        }\r\n        const offset = getOffset(this.proxy);\r\n        this.endClientX = this.startClientX = offset.x;\r\n        this.endClientY = this.startClientY = offset.y;\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * 触发拖动移动事件。\r\n     * @param e 事件对象。\r\n     */\r\n    move(e: MouseEvent) {\r\n        this.endClientX = this.startClientX + this.offsetX;\r\n        this.endClientY = this.startClientY + this.offsetY;\r\n        if (this.onDragMove && this.onDragMove(e, this) === false) {\r\n            return false;\r\n        }\r\n        this.proxy.style.top = this.endClientY + \"px\";\r\n        this.proxy.style.left = this.endClientX + \"px\";\r\n    }\r\n\r\n    /**\r\n     * 触发拖动结束事件。\r\n     * @param e 事件对象。\r\n     */\r\n    moveEnd(e: MouseEvent) {\r\n        this.onDragEnd && this.onDragEnd(e, this);\r\n    }\r\n\r\n    /**\r\n     * 自动滚动屏幕。\r\n     * @param scrollable 滚动的容器元素。\r\n     * @param padding 判断是否在区域内的最小距离。\r\n     * @param offset 如果需要滚动则额外偏移的距离。\r\n     */\r\n    autoScroll(scrollable?: Element | Document, padding?: number, offset?: number) {\r\n        scrollIntoViewIfNeeded(this.proxy, scrollable, 0, padding, offset);\r\n    }\r\n\r\n    /**\r\n     * 限制拖动的方向。\r\n     * @param value 要设置的方向。\r\n     */\r\n    direction(value: \"vertical\" | \"horizontal\") {\r\n        this[value === \"vertical\" ? \"endClientX\" : \"endClientY\"] = this[value === \"vertical\" ? \"startClientX\" : \"startClientY\"];\r\n    }\r\n\r\n    /**\r\n     * 限制只能在指定区域内拖动。\r\n     * @param container 限制的区域或元素。\r\n     * @param padding 容器的内边距。\r\n     */\r\n    limit(container: Document | Element | Rect, padding = 0) {\r\n        container = (container as Document | Element).nodeType ? getRect(container as Document | Element) : container as Rect;\r\n        this.proxy.style.top = this.endClientY + \"px\";\r\n        this.proxy.style.left = this.endClientX + \"px\";\r\n        const currentRect = getRect(this.proxy);\r\n        let t: number;\r\n        if ((t = currentRect.x - container.x - padding) <= 0 || (t = currentRect.x + currentRect.width - container.x - container.width + padding) >= 0) {\r\n            this.endClientX -= t;\r\n        }\r\n        if ((t = currentRect.y - container.y - padding) <= 0 || (t = currentRect.y + currentRect.height - container.y - container.height + padding) >= 0) {\r\n            this.endClientY -= t;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 设置拖动的步长。\r\n     * @param value 拖动的步长。\r\n     */\r\n    step(value: number) {\r\n        this.endClientY = this.startClientY + Math.floor((this.endClientY - this.startClientY + value / 2) / value) * value;\r\n        this.endClientX = this.startClientX + Math.floor((this.endClientX - this.startClientX + value / 2) / value) * value;\r\n    }\r\n\r\n    /**\r\n     * 还原位置。\r\n     * @param callback 渐变结束的回调函数。\r\n     * @param duration 渐变的总毫秒数。\r\n     */\r\n    revert(callback?: () => void, duration?: number) {\r\n        this.disable();\r\n        animate(this.proxy, {\r\n            left: this.startClientX,\r\n            top: this.startClientY,\r\n        }, () => {\r\n            this.enable();\r\n            callback && callback();\r\n        }, duration);\r\n    }\r\n\r\n    /**\r\n     * 使当前元素吸附于目标位置。\r\n     * @param target 吸附的目标区域或元素。\r\n     * @param padding 容器的内边距。\r\n     * @param distance 吸附的最小距离，当距离小于这个值后产生吸附效果。\r\n     * @param position 吸附的位置。\r\n     * @return 如果未吸附成功则返回 0，如果水平吸附成功则返回 1，如果垂直吸附成功则返回 2，如果都吸附成功则返回 3。\r\n     */\r\n    snap(target: Document | Element | Rect, padding = 0, distance = 15, position: \"both\" | \"inside\" | \"outside\" = \"both\") {\r\n        target = (target as Document | Element).nodeType ? getRect(target as Document | Element) : target as Rect;\r\n        const inside = position !== \"outside\";\r\n        const outside = position !== \"inside\";\r\n\r\n        this.proxy.style.top = this.endClientY + \"px\";\r\n        this.proxy.style.left = this.endClientX + \"px\";\r\n        const rect = getRect(this.proxy);\r\n\r\n        let r = 0;\r\n\r\n        let deltaX = distance;\r\n        if (inside) {\r\n            deltaX = target.x + padding - rect.x;\r\n            if (Math.abs(deltaX) >= distance) {\r\n                deltaX = target.x + target.width - padding - rect.x - rect.width;\r\n            }\r\n        }\r\n        if (Math.abs(deltaX) >= distance && outside) {\r\n            deltaX = target.x + padding - rect.x - rect.width;\r\n            if (Math.abs(deltaX) >= distance) {\r\n                deltaX = target.x + target.width - padding - rect.x;\r\n            }\r\n        }\r\n        if (Math.abs(deltaX) < distance) {\r\n            this.endClientX += deltaX;\r\n            r += 1;\r\n        }\r\n\r\n        let deltaY = distance;\r\n        if (inside) {\r\n            deltaY = target.y + padding - rect.y;\r\n            if (Math.abs(deltaY) >= distance) {\r\n                deltaY = target.y + target.height - padding - rect.y - rect.height;\r\n            }\r\n        }\r\n        if (Math.abs(deltaY) >= distance && outside) {\r\n            deltaY = target.y + padding - rect.y - rect.height;\r\n            if (Math.abs(deltaY) >= distance) {\r\n                deltaY = target.y + target.height - padding - rect.y;\r\n            }\r\n        }\r\n        if (Math.abs(deltaY) < distance) {\r\n            this.endClientY += deltaY;\r\n            r += 2;\r\n        }\r\n\r\n        return r;\r\n    }\r\n\r\n}\r\n\r\nDraggable.prototype.delay = 500;\r\n"],"mappings":"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"}