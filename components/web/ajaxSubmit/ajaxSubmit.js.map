{"version":3,"file":"ajaxSubmit.js","sources":["ajaxSubmit.ts"],"sourcesContent":["import ajax, { Ajax } from \"web/ajax\";\r\n\r\n/**\r\n * 异步提交表单数据。\r\n * @param elem 要提交的表单元素。\r\n * @param success 成功回调函数。\r\n * @param error 错误回调函数。\r\n * @param options 附加的额外选项。\r\n * @return 返回请求对象。\r\n * @example ajaxSubmit(document.getElementById(\"form\"))\r\n */\r\nexport default function ajaxSubmit(elem: HTMLFormElement, success?: Ajax[\"success\"], error?: Ajax[\"error\"], options?: Partial<Ajax>) {\r\n    return ajax({\r\n        type: elem.method,\r\n        url: elem.action,\r\n        contentType: elem.enctype,\r\n        withCredentials: true,\r\n        data: formData(elem),\r\n        success: success,\r\n        error: error,\r\n        ...options\r\n    });\r\n}\r\n\r\n/**\r\n * 获取表单的数据。\r\n * @param formElem 表单元素。\r\n * @param disabled 是否包含被禁用的元素。\r\n * @return 返回表单数据。如果表单不包含文件域，返回 JSON 对象。否则返回 FormData 对象。\r\n * @example formData(document.getElementById(\"form\"))\r\n */\r\nexport function formData(formElem: HTMLFormElement, disabled = false) {\r\n    const r: { [key: string]: string | string[] } = {};\r\n    let formData: FormData | undefined;\r\n    for (const input of formElem as any as (HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement)[]) {\r\n        const name = input.name;\r\n        if (name && (disabled || !input.disabled)) {\r\n            switch (input.type) {\r\n                case \"select-multiple\":\r\n                    for (const option of (input as HTMLSelectElement).options as any as HTMLOptionElement[]) {\r\n                        if (option.selected) {\r\n                            addValue(r, name, option.value || option.text);\r\n                        }\r\n                    }\r\n                    break;\r\n                case \"radio\":\r\n                    if ((input as HTMLInputElement).checked) {\r\n                        addValue(r, name, input.value || \"on\");\r\n                    }\r\n                    break;\r\n                case \"checkbox\":\r\n                    if ((input as HTMLInputElement).checked) {\r\n                        addValue(r, name, input.value || \"on\");\r\n                    }\r\n                    break;\r\n                case \"file\":\r\n                    formData = formData || new FormData();\r\n                    if ((input as HTMLInputElement).files) {\r\n                        for (const file of (input as HTMLInputElement).files! as any as File[]) {\r\n                            formData.append(name, file);\r\n                        }\r\n                    }\r\n                    break;\r\n                default:\r\n                    addValue(r, name, input.value);\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n    if (formData) {\r\n        for (const key in r) {\r\n            const value = r[key];\r\n            if (Array.isArray(value)) {\r\n                for (const item of value) {\r\n                    formData.append(key, item);\r\n                }\r\n            } else {\r\n                formData.append(key, value);\r\n            }\r\n        }\r\n        return formData;\r\n    }\r\n    return r;\r\n}\r\n\r\nfunction addValue(r: { [key: string]: string | string[] }, key: string, value: string) {\r\n    const exists = r[key];\r\n    if (Array.isArray(exists)) {\r\n        exists.push(value);\r\n    } else if (exists != undefined) {\r\n        r[key] = [exists, value];\r\n    } else {\r\n        r[key] = value;\r\n    }\r\n}\r\n"],"mappings":";;;;;;;;;;IAEA;;;;;;;;OAQG;IACH,oBAAmC,IAAqB,EAAE,OAAyB,EAAE,KAAqB,EAAE,OAAuB;QAC/H,MAAM,CAAC,cAAI,YACP,IAAI,EAAE,IAAI,CAAC,MAAM,EACjB,GAAG,EAAE,IAAI,CAAC,MAAM,EAChB,WAAW,EAAE,IAAI,CAAC,OAAO,EACzB,eAAe,EAAE,IAAI,EACrB,IAAI,EAAE,QAAQ,CAAC,IAAI,CAAC,EACpB,OAAO,EAAE,OAAO,EAChB,KAAK,EAAE,KAAK,IACT,OAAO,EACZ,CAAC;IACP,CAAC;IAXD,6BAWC;IAED;;;;;;OAMG;IACH,kBAAyB,QAAyB,EAAE,QAAgB;QAAhB,yBAAA,EAAA,gBAAgB;QAChE,IAAM,CAAC,GAAyC,EAAE,CAAC;QACnD,IAAI,QAA8B,CAAC;QACnC,GAAG,CAAC,CAAgB,UAAiF,EAAjF,KAAA,QAAiF,EAAjF,cAAiF,EAAjF,IAAiF;YAAhG,IAAM,KAAK,SAAA;YACZ,IAAM,MAAI,GAAG,KAAK,CAAC,IAAI,CAAC;YACxB,EAAE,CAAC,CAAC,MAAI,IAAI,CAAC,QAAQ,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;gBACxC,MAAM,CAAC,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC;oBACjB,KAAK,iBAAiB;wBAClB,GAAG,CAAC,CAAiB,UAAkE,EAAlE,KAAC,KAA2B,CAAC,OAAqC,EAAlE,cAAkE,EAAlE,IAAkE;4BAAlF,IAAM,MAAM,SAAA;4BACb,EAAE,CAAC,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC;gCAClB,QAAQ,CAAC,CAAC,EAAE,MAAI,EAAE,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,IAAI,CAAC,CAAC;4BACnD,CAAC;yBACJ;wBACD,KAAK,CAAC;oBACV,KAAK,OAAO;wBACR,EAAE,CAAC,CAAE,KAA0B,CAAC,OAAO,CAAC,CAAC,CAAC;4BACtC,QAAQ,CAAC,CAAC,EAAE,MAAI,EAAE,KAAK,CAAC,KAAK,IAAI,IAAI,CAAC,CAAC;wBAC3C,CAAC;wBACD,KAAK,CAAC;oBACV,KAAK,UAAU;wBACX,EAAE,CAAC,CAAE,KAA0B,CAAC,OAAO,CAAC,CAAC,CAAC;4BACtC,QAAQ,CAAC,CAAC,EAAE,MAAI,EAAE,KAAK,CAAC,KAAK,IAAI,IAAI,CAAC,CAAC;wBAC3C,CAAC;wBACD,KAAK,CAAC;oBACV,KAAK,MAAM;wBACP,QAAQ,GAAG,QAAQ,IAAI,IAAI,QAAQ,EAAE,CAAC;wBACtC,EAAE,CAAC,CAAE,KAA0B,CAAC,KAAK,CAAC,CAAC,CAAC;4BACpC,GAAG,CAAC,CAAe,UAAmD,EAAnD,KAAC,KAA0B,CAAC,KAAuB,EAAnD,cAAmD,EAAnD,IAAmD;gCAAjE,IAAM,IAAI,SAAA;gCACX,QAAQ,CAAC,MAAM,CAAC,MAAI,EAAE,IAAI,CAAC,CAAC;6BAC/B;wBACL,CAAC;wBACD,KAAK,CAAC;oBACV;wBACI,QAAQ,CAAC,CAAC,EAAE,MAAI,EAAE,KAAK,CAAC,KAAK,CAAC,CAAC;wBAC/B,KAAK,CAAC;gBACd,CAAC;YACL,CAAC;SACJ;QACD,EAAE,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;YACX,GAAG,CAAC,CAAC,IAAM,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;gBAClB,IAAM,KAAK,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC;gBACrB,EAAE,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;oBACvB,GAAG,CAAC,CAAe,UAAK,EAAL,eAAK,EAAL,mBAAK,EAAL,IAAK;wBAAnB,IAAM,IAAI,cAAA;wBACX,QAAQ,CAAC,MAAM,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;qBAC9B;gBACL,CAAC;gBAAC,IAAI,CAAC,CAAC;oBACJ,QAAQ,CAAC,MAAM,CAAC,GAAG,EAAE,KAAK,CAAC,CAAC;gBAChC,CAAC;YACL,CAAC;YACD,MAAM,CAAC,QAAQ,CAAC;QACpB,CAAC;QACD,MAAM,CAAC,CAAC,CAAC;IACb,CAAC;IApDD,4BAoDC;IAED,kBAAkB,CAAuC,EAAE,GAAW,EAAE,KAAa;QACjF,IAAM,MAAM,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC;QACtB,EAAE,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;YACxB,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QACvB,CAAC;QAAC,IAAI,CAAC,EAAE,CAAC,CAAC,MAAM,IAAI,SAAS,CAAC,CAAC,CAAC;YAC7B,CAAC,CAAC,GAAG,CAAC,GAAG,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC;QAC7B,CAAC;QAAC,IAAI,CAAC,CAAC;YACJ,CAAC,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC;QACnB,CAAC;IACL,CAAC"}