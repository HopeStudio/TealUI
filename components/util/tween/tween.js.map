{"version":3,"file":"tween.js","sources":["tween.ts"],"sourcesContent":["/**\r\n * 执行一个补间动画。\r\n * @param callback 要执行的动画回调函数。函数接收以下参数：\r\n * - value：变化因子，大小在 0-1 之间。可以根据此变化因子设置实际的样式。\r\n * @param duration 动画执行的总毫秒数。\r\n * @param timingFunction 渐变曲线。通过渐变曲线更改变化因子的变化方式。\r\n * @return 返回新补间动画对象。\r\n */\r\nexport default function tween(callback: Tween[\"set\"], duration?: Tween[\"duration\"], timingFunction?: Tween[\"timingFunction\"]) {\r\n    const r = new Tween();\r\n    r.set = callback;\r\n    if (duration != undefined) r.duration = duration;\r\n    if (timingFunction != undefined) r.timingFunction = timingFunction;\r\n    r.start();\r\n    return r;\r\n}\r\n\r\n/**\r\n * 表示一个补间动画。\r\n * @example\r\n * var tween = new Tween();\r\n * tween.set = x => { console.log(x); }\r\n * tween.start();\r\n */\r\nexport class Tween {\r\n\r\n    /**\r\n     * 动画执行的总毫秒数。\r\n     */\r\n    duration = 300;\r\n\r\n    /**\r\n     * 每秒显示的帧数。\r\n     */\r\n    fps = 50;\r\n\r\n    /**\r\n     * 渐变曲线。通过渐变曲线更改变化因子的变化方式。\r\n     * @param value 变化因子，大小在 0-1 之间。\r\n     * @return 返回转换后的变化因子，大小在 0-1 之间。\r\n     */\r\n    timingFunction(value: number) {\r\n        return -(Math.cos(Math.PI * value) - 1) / 2;\r\n    }\r\n\r\n    /**\r\n     * 当被子类重写时负责根据变化因子设置实际的值。\r\n     * @param value 变化因子，大小在 0-1 之间。可以根据此变化因子设置实际的样式。\r\n     */\r\n    set(value: number) { }\r\n\r\n    /**\r\n     * 动画结束后执行的回调函数。\r\n     */\r\n    done?: () => void;\r\n\r\n    /**\r\n     * 开始执行动画。\r\n     */\r\n    start() {\r\n        if (!this._timer) {\r\n            this._time = Date.now() - this._time;\r\n            this._timer = setInterval(() => {\r\n                this.progress();\r\n            }, Math.round(1000 / this.fps)) as any;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 停止执行动画。\r\n     */\r\n    stop() {\r\n        if (this._timer) {\r\n            this._time = Date.now() - this._time;\r\n            clearInterval(this._timer);\r\n            this._timer = 0;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 重置动画。\r\n     */\r\n    reset() {\r\n        this._time = 0;\r\n        this.set(0);\r\n    }\r\n\r\n    /**\r\n     * 存储渐变的计时器。\r\n     */\r\n    private _timer: number;\r\n\r\n    /**\r\n     * 存储渐变的执行时间。\r\n     */\r\n    private _time = 0;\r\n\r\n    /**\r\n     * 显示下一帧。\r\n     */\r\n    protected progress() {\r\n        const time = Date.now() - this._time;\r\n        if (time < this.duration) {\r\n            this.set(this.timingFunction(time / this.duration));\r\n        } else {\r\n            this.stop();\r\n            this.set(1);\r\n            this.done && this.done();\r\n        }\r\n    }\r\n\r\n}\r\n"],"mappings":";;IAAA;;;;;;;OAOG;IACH,eAA8B,QAAsB,EAAE,QAA4B,EAAE,cAAwC;QACxH,IAAM,CAAC,GAAG,IAAI,KAAK,EAAE,CAAC;QACtB,CAAC,CAAC,GAAG,GAAG,QAAQ,CAAC;QACjB,EAAE,CAAC,CAAC,QAAQ,IAAI,SAAS,CAAC;YAAC,CAAC,CAAC,QAAQ,GAAG,QAAQ,CAAC;QACjD,EAAE,CAAC,CAAC,cAAc,IAAI,SAAS,CAAC;YAAC,CAAC,CAAC,cAAc,GAAG,cAAc,CAAC;QACnE,CAAC,CAAC,KAAK,EAAE,CAAC;QACV,MAAM,CAAC,CAAC,CAAC;IACb,CAAC;IAPD,wBAOC;IAED;;;;;;OAMG;IACH;QAAA;YAEI;;eAEG;YACH,aAAQ,GAAG,GAAG,CAAC;YAEf;;eAEG;YACH,QAAG,GAAG,EAAE,CAAC;YA0DT;;eAEG;YACK,UAAK,GAAG,CAAC,CAAC;QAgBtB,CAAC;QA3EG;;;;WAIG;QACH,8BAAc,GAAd,UAAe,KAAa;YACxB,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,GAAG,KAAK,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC;QAChD,CAAC;QAED;;;WAGG;QACH,mBAAG,GAAH,UAAI,KAAa,IAAI,CAAC;QAOtB;;WAEG;QACH,qBAAK,GAAL;YAAA,iBAOC;YANG,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC;gBACf,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,KAAK,CAAC;gBACrC,IAAI,CAAC,MAAM,GAAG,WAAW,CAAC;oBACtB,KAAI,CAAC,QAAQ,EAAE,CAAC;gBACpB,CAAC,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,CAAQ,CAAC;YAC3C,CAAC;QACL,CAAC;QAED;;WAEG;QACH,oBAAI,GAAJ;YACI,EAAE,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC;gBACd,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,KAAK,CAAC;gBACrC,aAAa,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;gBAC3B,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC;YACpB,CAAC;QACL,CAAC;QAED;;WAEG;QACH,qBAAK,GAAL;YACI,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;YACf,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;QAChB,CAAC;QAYD;;WAEG;QACO,wBAAQ,GAAlB;YACI,IAAM,IAAI,GAAG,IAAI,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,KAAK,CAAC;YACrC,EAAE,CAAC,CAAC,IAAI,GAAG,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;gBACvB,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,cAAc,CAAC,IAAI,GAAG,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;YACxD,CAAC;YAAC,IAAI,CAAC,CAAC;gBACJ,IAAI,CAAC,IAAI,EAAE,CAAC;gBACZ,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;gBACZ,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,IAAI,EAAE,CAAC;YAC7B,CAAC;QACL,CAAC;QAEL,YAAC;IAAD,CAAC,AAvFD,IAuFC;IAvFY,sBAAK"}