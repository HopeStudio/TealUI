{"version":3,"file":"tpl.js","sources":["tpl.ts"],"sourcesContent":["/**\r\n * 渲染一个 EJS（ASP/JSP）模板。\r\n * @param tpl 模板内容。在模板中使用 `<% ... %>` 插入 JavaScript 语句，使用 `<%= ... %>` 插入 JavaScript 表达式，使用 `$` 表示传入的数据。\r\n * @param data 传递给模板的数据。\r\n * @return 返回模板渲染后的结果。\r\n */\r\nexport default function tpl(tpl: string, data: any): any;\r\n\r\n/**\r\n * 编译一个 EJS（ASP/JSP）模板。\r\n * @param tpl 模板内容。在模板中使用 `<% ... %>` 插入 JavaScript 语句，使用 `<%= ... %>` 插入 JavaScript 表达式，使用 `$` 表示传入的数据。\r\n * @return 返回编译后的模板函数。函数有以下参数：\r\n * - data：传递给模板的数据。\r\n *\r\n * 函数返回模板渲染后的结果。\r\n */\r\nexport default function tpl(tpl: string): (data: any) => any;\r\n\r\nexport default function tpl(tpl: string, data?: any) {\r\n    let end = \"\";\r\n    tpl = `var $output=\"\",$t${(`%>${tpl}<%`).replace(/%>([\\s\\S]*?)<%(=?)/g, (all, content: string, eq?: string) => {\r\n        all = `${end};${content ? `$output+=${JSON.stringify(content)};` : \"\"}`;\r\n        if (eq) {\r\n            all += `$t =(`;\r\n            end = \");if($t!=null)$output+=$t\";\r\n        } else {\r\n            end = \"\";\r\n        }\r\n        return all;\r\n    })}`;\r\n    const func = new Function(\"$\", `${tpl}${end}return $output`);\r\n    if (data === undefined) {\r\n        return func;\r\n    }\r\n    return func.call(data, data);\r\n}\r\n"],"mappings":";;IAkBA,aAA4B,GAAW,EAAE,IAAU;QAC/C,IAAI,GAAG,GAAG,EAAE,CAAC;QACb,GAAG,GAAG,wBAAoB,CAAC,OAAK,GAAG,OAAI,CAAC,CAAC,OAAO,CAAC,qBAAqB,EAAE,UAAC,GAAG,EAAE,OAAe,EAAE,EAAW;YACtG,GAAG,GAAM,GAAG,UAAI,OAAO,CAAC,CAAC,CAAC,cAAY,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,MAAG,CAAC,CAAC,CAAC,EAAE,CAAE,CAAC;YACxE,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;gBACL,GAAG,IAAI,OAAO,CAAC;gBACf,GAAG,GAAG,2BAA2B,CAAC;YACtC,CAAC;YAAC,IAAI,CAAC,CAAC;gBACJ,GAAG,GAAG,EAAE,CAAC;YACb,CAAC;YACD,MAAM,CAAC,GAAG,CAAC;QACf,CAAC,CAAG,CAAC;QACL,IAAM,IAAI,GAAG,IAAI,QAAQ,CAAC,GAAG,EAAE,KAAG,GAAG,GAAG,GAAG,mBAAgB,CAAC,CAAC;QAC7D,EAAE,CAAC,CAAC,IAAI,KAAK,SAAS,CAAC,CAAC,CAAC;YACrB,MAAM,CAAC,IAAI,CAAC;QAChB,CAAC;QACD,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;IACjC,CAAC;IAjBD,sBAiBC"}