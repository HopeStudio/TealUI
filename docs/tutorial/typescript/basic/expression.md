第三章 表达式
========================================================
表达式(Expression)类似数学里的公式。
表达式计算后一定会返回一个值。

TypeScript 中表达式有以下几种：

1. [常量表达式(Constant Expression)](#31常量表达式)
2. [单目表达式(Unary Expression)](#32单目表达式)
3. [双目表达式(Binary Expression)](#33双目表达式)
4. [三目表达式(Conditional Expression)](#34三目表达式)

作为基础，我们需要要能**说出每个表达式的计算结果及返回类型**。

3.1 常量表达式(Constant Expression)
--------------------------------------------------------
常量表达式有：常量(字面量)、变量(标识符)、`this`、`super`(JavaScript 5 开始支持)。

### 3.1.1 常量(字面量)
常量就是 [第二章 类型](type.md) 中介绍的每个类型的直接写法。
如 `1`, `false`, `undefined` 都是常量。

> 练习: 说出以下常量的类型。
> `0`
> `true`
> `NaN`
> `undefined`
> `"1"`
> `[]`
> `1e1`
> `null`

### 3.1.2 变量(标识符)
变量就像数学里的未知数，它可以用于存储一个值并用于计算。

变量名可以使用任意个英文字母、数字、`_`(下划线)、`$`(美元符)、汉字组成，但是不能以数字开头。
程序中变量的命名应该尽量符合变量本身表示的含义，避免使用类似 `x`, `y`, `a`, `b`, `c` 等纯字母命名。
变量名应尽量使用小写字符，如果变量命名是由多个单词组成的，推荐命名规则是除首个单词外其它单词首字母大写，如 `nameOfUser`。

> 常见问题：
> [如何使用键盘打出 `_`?](../qa.md#)

> 练习: 以下哪些是合法的变量名：
> `a`
> `xld`
> `$x`
> `-x`
> `_0`
> `bug@tealui.com`
> `3x`

### 3.1.3 `this` 和 `super`(JavaScript 5 开始支持)
`this` 和 `super`(JavaScript 5 开始支持) 是在面向对象编程中表示当前类和超类，具体将在 [第九章 面向对象](../advance/oop.md) 中介绍。

3.2 单目表达式(Unary Expression)
--------------------------------------------------------
单目表达式即只有一个运算符的表达式。
单目运算符有：
- `+`(正)、`-`(负)、`~`([位反](../type.md#位反：按位更新，原来的1改0，原来的0改 1), 
- `!`(非), 
- `void`(空), 
- `delete`(删除)
- `typeof`(获取类型)
- `new`(创建对象)
- `...`(展开)(JavaScript 5 开始支持)
- `++`(累加)、`--`(累减)。

### 3.2.1 `+`(正), `-`(负), `~`(位反)
由于只有数字才能做正/负/位反运算。
因此系统会把原值自动转为数字然后作正/负/位反运算。

> 练习：计算下列表达式的值：
> `+0`
> `-2`
> `+""`
> `-[1]`

### 3.2.2 `!`(非)
系统会把原值自动转为布尔然后作非运算。

> 练习：计算下列表达式的值：
> `!false`
> `!1`
> `!0`
> `![1]`
> `!"abc"`
> `!!0`

### 3.2.3 `void`(空)
`void` 运算固定返回 `undefined`。

> 练习：计算下列表达式的值：
> `void 0`
> `void void void 1`

### 3.2.4 `delete`(删除)
`delete` 运算可以用于删除一个键，如果原键存在并删除成功，则返回 `true`；否则返回 `false`。
`delete` 运算的操作数必须是一个索引运算。

> 练习：计算下列表达式的值：
> `delete {x:1}.x`
> `delete "0".y`
> `delete "0"["y"]`

### 3.2.5 `typeof`(获取类型)
`typeof` 可以用于判断值的类型，并返回一个字符串，包含类型的名字。

每个类型的返回如下：

类型       | 返回值
-----------|------------
数字       | "number"
字符串     | "string"
布尔       | "boolean"
`undefined`| "undefined"
`函数`     | "function"
其它引用类型| "object"

> 练习：计算下列表达式的值：
> `typeof false`
> `typeof NaN`
> `typeof null`
> `typeof 2 - 5`
> `typeof void 0`
> `typeof []`
> `typeof !![]`
> `typeof typeof 0`
> `typeof {}`
> `typeof "number"`

### 3.2.6 `new`(创建对象)
`new` 可以用于动态创建一个自定义对象。
比如 `new Array` 就是创建一个空数组。

### 3.2.7 `...`(展开)(JavaScript 5 开始支持)
如果一个数组包含了函数的全部参数，可以直接使用 `...` 展开此数组。
如 `fn(1, ...[2, 3, 4])` 等效于 `fn(1, 2, 3, 4)`。

### 3.2.8 `++`(累加), `--`(累减)
累加和累减可以用于更新变量的值为其作加/减 1 的运算。

只有变量和索引才能作累加/累减运算。

累加/累减运算分成前缀和后缀模式。
前缀如 `x++` 是运算当前表达式的值，然后更新。
后缀如 `++x` 则是先更新，然后运算表达式的值。

> 练习：假设 `x = 1`，计算下列表达式的值：
> `++x + 1`
> `x++ + 1`
> `++x - x++`
> `x++ + ++x`

3.3 双目表达式(Binary Expression)
--------------------------------------------------------
双目表达式由左右两个运算数和一个运算符组成。

双目运算符有：
- `+`(加)、`-`(减)、`*`(乘)、`/`(除)、`%`(取余)
- `< `(小于)、`>`(大于)、`<=`(小于等于)、`>=`(大于等于)
- `===`(严格等于)、`==`(等于)、`!==`(严格不等于)、`!=`(不等于)
- `&`(位与)、`|`(位或)、`<< `(左移)、`>>`(右移)、`>>>`(无符右移)
- `&&`(与)、`||`(或)
- `=`(等于/赋值)、`+=`(加等于)、`-=`(减等于)、`*=`(乘等于)、`/=`(除等于)、`%=`(取余等于)、`&=`(位与)、`|=`(位或等于)、`<<=`(左移等于)、`>>=`(右移等于)、`>>>=`(无符右移等于)
- `in`(包含)
- `instanceof`(判断实例)
- `<>`/`as`(类型转换)(TypeScript 特有)

### 3.3.1 `+`(加)、`< `(小于)、`>`(大于)、`<=`(小于等于)、`>=`(大于等于)
数字和字符串都可用于以上运算。

如果左右值都是数字、布尔、`null`、`undefined`，则左右值都会转为数字再计算。
否则，左右值都会转为字符串再计算。

> 练习：计算下列表达式的值：
> `1 + 1`
> `1 + []`
> `undefined + 2`
> `null + 2`
> `[] + []`
> `[1] + [1]`
> `1 + 2 + "3" + 4 + 5`

### 3.3.2 `-`(减)、`*`(乘)、`/`(除)、`%`(取余)、`&`(位与)、`|`(位或)、`<< `(左移)、`>>`(右移)、`>>>`(无符右移)
以上运算只适合数字。
左右值先转为数字再计算。

### 3.3.3 `===`(严格等于)、`==`(等于)、`!==`(严格不等于)、`!=`(不等于)
判断对象是否相等：

- 基础类型直接比较值是否相等。
- 引用类型则比较左右值是否引用同一个对象。

由于每次书写引用类型的常量都相当于创建了一个新的引用，
因此引用类型的常量即使看起来相同，也还是不等的。

`===` 和 `!==` 要求比较的两个值具有完全相同的类型。
`==` 和 `!=` 则允许自动类型转换，具体方法为：

- `null` 和 `undefined` 相等，但它们和其它值比较时都返回 `false`。
- 如果左右值任一方是布尔，则左右值都会转为布尔再计算。
- 如果左右值任一方是数字，则左右值都会转为数字再计算。
- 如果左右值任一方是字符串，则左右值都会转为字符串再计算。
- 如果是基础类型和引用类型比较则返回 `false`。
- 如果是引用类型和引用类型比较则判断是否属于同一个引用。

> 练习：计算下列表达式的值：
> `1 === 1`
> `1 == true`
> `[] == ""`
> `[] === []`
> `{} == {}`
> `1.00000 == 1e0`
> `0 != []`

### 3.3.4 `&&`(与)、`||`(或)
左值会自动转为布尔。

> 练习：计算下列表达式的值：
> `1 && 0`
> `0 && 1`
> `null || undefined || "" || "hello"`

### 3.3.5 `=`(等于/赋值)、`+=`(加等于)、`-=`(减等于)、`*=`(乘等于)、`/=`(除等于)、`%=`(取余等于)、`&=`(位与)、`|=`(位或等于)、`<<=`(左移等于)、`>>=`(右移等于)、`>>>=`(无符右移等于)
赋值就是将右值赋给左值。
赋值运算的左值只能是变量或索引。

`x += y` 是 `x = x + y` 的简写。

对于引用类型，赋值时将只是复制引用，因此被赋值的变量和原变量属于同一份引用，两者共享数据。

### 3.3.6 `in`(包含)
包含运算可用于判断右值是否存在左值指定的键。
此运算的左值会自动转为字符串，右值则必须是引用类型。

### 3.3.7 `instanceof`(判断实例)
本运算可用于判断左值是否使用右值创建出来的对象。
右值必须是引用类型。

### 3.3.8 `<>`/`as`(类型转换)(TypeScript 特有)
TypeScript 追加了类型转换可强制更改变量类型。
转换方式为：<code>&lt;类型>值</code> 或 `值 as 类型`。如 <code>&lt;boolean>int</code>。 

3.4 三目表达式(Conditional Expression)
三目表达式即：`?:`。

计算表达式 `x ? y : z` 的方法是将 `x` 转为布尔，如果结果是 `true`，则返回 `y`，否则返回 `z`。

> `x ? y : z` 可以读作：“x 是 true 吗? 如果是则返回 y,否则返回 z。”
