第二章 类型
========================================================
就像我们在研究动物时，会先将动物分成哺乳类、爬行类等很多种类。
同样地，程序中我们也把数据分成很多类型(Type)，以方便处理。

TypeScript 内置提供了以下几种数据类型：

- `number`
- `boolean`
- `string`
- `void`(在 JavaScript 称为 `undefined`)
- `any`(TypeScript 特有)
- `Array`
- `Object`
- `Function`

对于每种类型，我们都需要熟练掌握其**表示方式**、**格式规范**、以及**支持的运算**，这是编程的基础。
掌握了表示方式，我们就可以知道应该如何去表达一个类型；
掌握了格式规范，我们就可以根据类型写出合法的值；
掌握了支持的运算，我们就可以正确地进行数据处理。

下面将依次介绍这几个类型。

2.1 `number`: 数字
--------------------------------------------------------
数字包括整数和小数。

### `number` 表示方式
数字类型可以直接用 `number`(推荐) 或 `Number` 表示。

### `number` 格式规范
数字可以使用以下任一格式表示：

- 十进制：十进制格式就是日常生活广泛使用的数字格式，如 `0`, `1024`, `3.1415926`。小数点前的 `0` 可以省略，如 `.01`。
- 科学计数法：如 `3e4` 或 `3E4`, 其值等于 <code>3 × e<sup>4</sup></code>(其中 `e` 是数学中的自然常数)。`e` 后可以紧跟一个 `+`(正) 或 `-`(负) 号。
- 十六进制：以 `0x` 或 `0X` 开头，如 `0xFf`。
- 八进制：以 `0o` 或 `0O` 开头，如 `0o74563`。
- 二进制：以 `0b` 或 `0B` 开头，如 `0b0010`。

> 提示：整数可以使用任意格式表示，小数则只能使用十进制或科学计数法格式。
> 提示：受存储空间的限制，数字可表示的范围是 <code>[5 × e<sup>-324</sup>, 1.7976931348623157 × e<sup>308</sup>)</code>(左闭右开区间)。

> 常见问题：
> [什么是进制?](../qa.md#)
> [什么是科学计数法?](../qa.md#)
> [什么是自然常数?](../qa.md#)
> [什么是左闭右开区间?](../qa.md#)

此外，计算机中还存在两个特殊的数字：`Infinity` 和 `NaN`。

- `Infinity` 表示正无穷大(∞)，同时也表示超出范围的数字。如 `1 ÷ 0` 的值为 `Infinity`。
- `NaN`(Not A Number, 不是数字)表示无意义的数字。如 `0 ÷ 0` 的值为 `NaN`。

> 常见问题：
> [什么是正无穷大?](../qa.md#)

> 练习: 以下哪些是合法的数字?
> - `0`
> - `.123`
> - `3.`
> - `.`
> - `2011.11.11`
> - `-1`
> - `1 + 1`
> - `0x`
> - `0xWHO`
> - `00000`
> - `Infinity`
> - `4e-3`
> - `4e - 3`
> - `FF`
> - `0b2`
> - `200f`
> - `200x`
> - `98%`
> - `NaN`

### `number` 支持的运算
数字可以作以下三种运算：数学运算、比较运算和位运算。

#### 数学运算
数学运算有：`+`(加/正), `-`(减/负), `*`(乘), `/`(除), `%`(取余)。
其中 `+`, `-`, `*`, `/` 就是大家熟知的四则运算，四则运算是计算机的基本能力。`%` 表示计算前者除以后者的余数，如 `8 % 5` 等于 `3`。`x % y` 等价于 `x - (x ÷ y)的整数部分 * y`。

如果计算的两个值都是数字类型，则返回值也是数字类型。
否则程序会先进行类型转换再计算，具体细节将在 [2.9 类型转换](#) 介绍。

代码中的运算和数学公式相同，也存在优先级。
要更改优先级，需要使用小括号，如 `(1 - (2 - 4)) * 3`。

> 注意：由于计算机内部是使用二进制表示数字的，而小数的二进制和十进制转换过程会出现微量误差，因此程序在计算时可能存在微量误差，在计算货币时应特别注意。

> 练习: 计算下列表达式的值：
> - `1 + 1`
> - `-0`
> - `1 / 0`
> - `(1 - 1) / (1 - 1)`
> - `0xf - 0xe`
> - `29 % 100`
> - `2.4 % 2.3`
> - `2 / 3`
> - `(1 - 4) / (500000 - 500000)`
> - `-1 - -1`

#### 比较运算
比较运算有：`< `(小于), `>`(大于), `<=`(小于等于), `>=`(大于等于), `===`(严格等于), `==`(等于), `!==`(严格不等于), `!=`(不等于)。
    
其中，`===`, `==`, `!==`, `!=` 适用于任何类型，在接下来的章节中将不再重复介绍。
`===` 和 `==` 的区别在于前者要求比较的双方具有完全相同的类型(比如都是数字类型)，而后者则允许先进行类型转换再比较(具体细节将在 [2.9 类型转换](#) 介绍)。`!==` 和 `!=` 同理。

> 注意：请勿将 `==` 写成 `=`。
> 注意：如果运算符是由多个字母组成的，中间不能加任何空格，如 `> =` 是错误的。

比较运算会返回布尔类型的值。布尔类型主要用于表示真假(对错)，具体将在下一节介绍。

需要特别注意的是 `NaN` 和任何数值比较都是无意义的，因此其比较结果也总是返回“错”。

> 练习: 说出以下比较是对的还是错的：
> - `1 > 1`
> - `0 >= 1`
> - `1 == 1`
> - `Infinity >= -1`
> - `-2 > -Infinity`
> - `0xFFFF < 0xEEEE`
> - `Infinity >= Infinity`
> - `-Infinity >= Infinity`
> - `NaN > NaN`
> - `NaN < NaN`
> - `NaN == NaN`
> - `NaN != NaN`
> - `NaN != NaN`
> - `Infinity > NaN`

#### 位运算
位运算是计算机领域特定的计算。
计算机内部使用二进制存储数字，位运算就是直接操作二进制数值的运算。
位运算有 `&`(位与), `|`(位或), `<< `(左移), `>>`(右移), `>>>`(无符右移), `~`(位反)。

##### `&`：按位合并，如果两个数字都为 1 则返回 1，否则返回 0。

如计算 `3 & 6` 的方法：

1. 取整并转为二进制格式：`0b0011 & 0b0110`。
2. 取左值第一位：`0`；取右值第一位：`0`；计算 `0 & 0` 返回 `0`。
3. 取左值第二位：`0`；取右值第二位：`1`；计算 `0 & 1` 返回 `0`。
4. 取左值第三位：`1`；取右值第三位：`1`；计算 `1 & 1` 返回 `1`。
5. 取左值第四位：`1`；取右值第四位：`0`；计算 `1 & 0` 返回 `0`。
6. 合并每位的结果，得到 `0b0010`，即 `2`。

##### `|`：按位合并，如果两个数字任一个为 1 则返回 1，否则返回 0。

如计算 `3 | 6` 的方法：

1. 取整并转为二进制格式：`0b0011 & 0b0110`。
2. 取左值第一位：`0`；取右值第一位：`0`；计算 `0 & 0` 返回 `0`。
3. 取左值第二位：`0`；取右值第二位：`1`；计算 `0 & 1` 返回 `1`。
4. 取左值第三位：`1`；取右值第三位：`1`；计算 `1 & 1` 返回 `1`。
5. 取左值第四位：`1`；取右值第四位：`0`；计算 `1 & 0` 返回 `1`。
6. 合并每位的结果，得到 `0b0111`，即 `7`。

###### `<< `(左移)：按位向左移动，低位补 0。

如计算 `3 << 2` 的方法：

1. 取整并转为二进制格式：`0b0011 << 2`。
2. 高位(左边)删除 2 位，返回 `0b11`
3. 低位(右边)补上 2 个 0，返回 `0b1100`，即 12。

> 提示: `x << y` 等价于 <code>x × 2<sup>y</sup></code>。

###### `>>`(右移)：按位向右移动，高位补原来的最高位。

如计算 `3 >> 2` 的方法：

1. 取整并转为二进制格式：`0b0011 >> 2`。
2. 低位(右边)删除 2 位，返回 `0b00`
3. 高位(左边)补上 2 个 `0b0011` 的最高位(即 0)，返回 `0b0000`，即 0。

> 提示: `x >> y` 等价于 <code>x ÷ 2<sup>y</sup></code>。

###### `>>>`(无符右移)：按位向右移动，高位补 0。
类似 `>>`，只是高位固定地补 0。

###### `~`(位反)：按位更新，原来的 1 改 0，原来的 0 改 1。

如计算 `~3` 的方法：

1. 取整并转为二进制格式：`0b000...011`。
2. 每位取反，得到 `0b111...100`，即 `-4`。

> 提示: `~x` 等价于 `-x - 1`。
> 提示: `~~x` 等价于 `x 的整数部分`。

> 注意：执行位运算时所有操作数都先会转为整数。整数的表示范围是 <code>[0, 2<sup>64</sup>)</code>，超过这个范围的数值执行位运算会产生误差。

> 练习: 计算以下表达式的值：
> - `0xFFF > 3`
> - `0xE | 3`
> - `(2334 * 2) | 3`
> - `(1 << 2) | (1 << 6)`
> - `~2 & 2`
> - `2.4 | 4.3`
> - `2.4 | 4.3 | 5`

2.2 `boolean`: 布尔
--------------------------------------------------------
布尔型可以用于表示一个真(对)或假(错)的值。
比如数字比较时就会返回一个布尔型的值以表示比较结果。

### `boolean` 表示方式
布尔类型可以直接用 `boolean`(推荐) 或 `Boolean` 表示。

### `boolean` 格式规范
布尔型的值只可能是：`true`(表示真/对) 和 `false`(表示假/错)。

### `boolean` 支持的运算
布尔型只能作逻辑运算。
逻辑运算有：`&&`(与), `||`(或), `!`(非)。

- `&&`(与): 前者为 `false` 则返回前者，否则返回后者。
- `||`(或): 前者为 `true` 则返回前者，否则返回后者。
- `!`(非): `!true` 返回 `false`，`!false` 返回 `true`。

数字比较返回 `true` 或 `false`，如 `(4 > 3) && (2 < 5)` 等价于 `true && true`, 即 `true`。

在执行逻辑运算时，如果已经确定返回前者时，后者是不再继续计算的。
如 `false && (2 > 3)` 中已经确定返回前者 `false`，这里 `2 > 3` 不会再计算。

> 提示: `!(x && y)` 等价于 `!x || !y`；`!(x || y)` 等价于 `!x && !y`。

> 练习: 计算以下表达式的值：
> - `1 > 0 || 0 > 1`
> - `!((1 & 2) > 4) && false`
> - `false || 3`
> - `(true && false) || 1`

2.3 `string`: 字符串
--------------------------------------------------------
字符串即一段文本。

### `string` 表示方式
字符串类型可以直接用 `string`(推荐) 或 `String` 表示。

#### `string` 格式规范
字符串必须使用 `'`、`"` 或 `\`` 包围，如：
```
'text'
"我是字符串"
`我也是字符串`
```

其中，使用引号包围的字符串是普通字符串；使用 `\`` 包围的字符串也叫模板字符串。
普通字符串里不能直接书写引号和换行。

如果字符串本身包含引号、换行、不可见字符等特殊字符，需要使用转义字符表示。
转义字符是以 \ 开头的特殊字符。
TypeScript 支持使用以下转义字符：

转义字符   | 意义
----------| ------------------------
`'\''`    | 表示一个单引号(')。
`'\"'`    | 表示一个双引号(")。
`'\\'`    | 表示一个反斜杠(\)。
`'\n'`    | 表示一个换行符。
`'\r'`    | 表示一个回车符。
`'\t'`    | 表示一个制表符。
`'\v'`    | 表示一个垂直制表符。
`'\b'`    | 表示一个退格符。
`'\f'`    | 表示一个分页符。
`'\0'`    | 表示一个空字符。
`'\x##'`  | 表示一个 ASCII 字符，其中 ## 是对应 ASCII 字符的十六进制编码。
`'\u####'`| 表示一个 Unicode 字符，其中 #### 是对应 Unicode 字符的十六进制编码。

比如要在字符串中包含一个单引号，应该写成 '单引号写成：`\'`，不然可能被误认为是字符串结束标记`'`，
在单引号字符串中，双引号可以不用转义，反之亦然。

不包含任何文本的字符串(即 `""`) 叫做空字符串。

> 练习: 以下哪些是合法的字符串?
> - `''`
> - `"'"`
> - `"他说:"我不去。""`
> - `'`

### `string` 支持的运算
字符串可以作连接运算、索引运算和比较运算。

#### 连接运算
连接运算即 `+`。
连接运算可以拼接两个字符串为一个。如 `"hello" + " world"` 返回 `"hello world"`。

如果需要做大量的加法运算，可以使用模板字符串中的代码段功能，写法 `\`hello ${", "} world\`` 等效于 `"hello " + ", " + " world"`。
如果不希望 `${}` 被误认为代码段，同样需要使用转义字符，写成 `\${ ... }`。

#### 索引运算
索引运算即 `[]`。

字符串作索引运算可以返回字符串中的特定位置的字符。
程序中计数都是从 0 开始的，
如 "hello"[0] 即返回字符串中的第 1 个字符 "h"。

如果索引超出返回则返回空字符串。

> 注意，在部分老浏览器不支持字符串的索引运算。

#### 比较运算
字符串比较运算同数字，其比较的方式是依次比较两个字符串同位置字符串的字典顺序(即按英文字母 a-z 的排序方式)，返回首个差异的字符。

如比较 `"hel" < "ha"` 的方法为：
1. 取左边第一个字符 "h"；取右边第一个字符 "h"；比较相同，则继续比较。
2. 取左边第一个字符 "e"；取右边第一个字符 "a"；根据字典顺序 `e > a`，因此最终比较结果为 `false`。

2.3 `void`: 未定义
--------------------------------------------------------
未定义类型是一种特殊类型，它表示不存在的值。

### `void` 表示方式
未定义类型可以直接用 `void` 表示。

#### `void` 格式规范
未定义类型的值只可能是：`undefined`。

### `void` 支持的运算
未定义类型不支持任何运算。

2.4 `any`: 任意类型
--------------------------------------------------------
任意类型是一种特殊类型，它表示任意类型。
任意类型是 TypeScript 特有的类型，她能取代任意的类型。

### `any` 表示方式
任意类型可以直接用 `any` 表示。

#### `any` 格式规范
任何值都可以是任意类型。

### `any` 支持的运算
任意类型的值支持任意的运算。具体计算的结构需要根据值的实际类型决定。

2.5 `Array`: 数组
--------------------------------------------------------
数组就像数学里的数列，它可以容纳任意个元素并对它们进行批量操作。

### `Array` 表示方式
根据元素的不同，数组类型的表示方式也不同。

如果数组内包含不确定个数的类型为 `T` 的元素，需要使用 `T[]` 或 <code>Array&lt;T></code> 表示。
比如任意个数字组成的数组类型，用 `number[]` 表示。

如果数组里元素类型不统一或者不明确，可以用 `any[]` 表示。

如果数组的元素本身也是数组，即二维数组，可以用 `T[][]` 表示，其本质上是 `(T[])[]` 的简写。

如果数组内包含确定个数的元素，可以直接使用 `[T1, T2, ...] `表示，其中 `T1`, `T2`... 是每个元素的类型。如 `[number, string]`。

### `Array` 格式规范
数组必须使用 `[]` 包围，每个元素用逗号分开，如：`[1, 2, 3]`。

不含元素的数组(即 `[]`) 叫做空数组。

> 练习: 说出下列数组的类型：
> - `[1, 2, 3, 4, 5]`
> - `[1, ""]`
> - `[]`
> - `[[]]`
> - `[[1, 2, 3], [4, 5, 6], [7, 3, 4]]`
> - `[false, true, false, false]`
> - `[[""], false]`

> 练习: 根据以下类型写出一些示例数组：
> - `number[]`
> - `([number, string])[]`
> - `any[][][]`
> - <code>Array&lt;[]></code>
> - <code>Array&lt;Array&lt;any[]>></code>

### `Array` 支持的运算
数组只能可以作索引运算。
索引运算写法同字符串，如 `([1, 2, 3])[0]` 返回数组 `[1, 2, 3]` 的第一个元素，值为 `1`。

如果索引超出返回则返回 `undefined`。

> 练习: 计算以下表达式的值：
> - [0][0]
> - [0][1]
> - ["hello"][0][0]
> - [1 + 1, 1 - 1, 1 * 1, 1 / 1]
> - [1 + 1][1 + 1]

2.6 `Object`: 对象
--------------------------------------------------------
对象类似于数组，可以包含多个数据，但它可以为包含的数据分别命名，称为键名(Key)。

在 TypeScript 中，一切都是对象。
所以任何类型都可以当做 `Object` 类型处理。

### `Object` 表示方式
对象类型可以直接用 `Object` 表示，但建议用更明确的方式来表示这个对象包含了哪些键。

如果对象内包含固定的键，需要一一列出，比如表示一个包含 `x` 和 `y` 两个键的对象：`{x: number, y: number}`。

键名可以写单词、字符串或数字，但如果键名包含特殊字符(比如空格、符号等)，则必须写成字符串，如 `{"+": number}`。
在键名后加 `?`，表示该键是可缺省的，如 `{x: number, y?: number}`。

如果对象允许包含任意非数字的键，则应使用 `{ [key: string`]: any }` 表示。
如果对象允许包含任意数字的键，则应使用 `{ [key: number`]: any }` 表示。
如果对象运算包含任意键，需使用 `{ [key: string`]: any, [key: number`]: any }`。

### `Object` 格式规范
对象必须使用 `{}` 包围，如：`{x: 1, y: 2}`。

不含键的对象(即 `{}`)叫做空对象。

### `Object` 支持的运算
对象只能作索引运算。
索引运算有 `[]` 和 `.` 两种。

`[]` 的用法同数组，唯一区别是键可以是字符串，如 `({x: 1, y: 2})["x"]` 返回数组 `{x: 1, y: 2}` 的 `x` 对应的值 `1`。

`.` 是 `[]` 的简写，`x.y` 等价于 `x["y"]`。如 `({x: 1, y: 2}).x` 返回 `1`。

如果找不到键则返回 `undefined`。

> 练习: 说出下列对象的类型：
> - `{a: 1, b: false, c: ""}`
> - `{}`
> - `{a: {}, c: [{}]}`

> 练习: 根据以下类型写出一些示例对象：
> - `{x: number, y: string}`
> - `{x: boolean}[]`
> - `{[key: string]: [string]}`

> 练习: 计算下列表达式的值：
> - `({})[1]`
> - `{x: boolean}[]`
> - `{[key: string]: [string]}`

2.7 `Function`: 函数
--------------------------------------------------------
这里的函数和数学中函数的功能相同，
函数可以被调用执行，
函数调用时可传递若干个参数，
函数执行后将返回一个值。

### `Function` 表示方式
函数类型可以直接用 `Function` 表示，但建议用更明确的方式来表示这个函数的参数和返回值信息。

要表示一个拥有 `number` 类型的 `x` 和 `number` 类型的 `y` 两个参数且返回类型是 `boolean` 的函数，表示方式为：`(x: number, y: number) => boolean`。

在参数名后加 `?` 表示该参数是可缺省的，如 `(x: number, y?: number) => boolean`。

在参数名前加 `...` 表示该参数是动态参数，如 `(x: number, ...y: number[]) => boolean`。
动态参数的类型必须是数组。
动态参数可以让函数接收任意个参数。

> 注意：缺省参数后不能有非缺省参数。动态参数必须是最后一个参数。

函数也可以使用类似 `Object` 类型的方式表示：`{ (x: number, y: number): number; }`。
通过此方式可以表示函数的多种传参方式以及其自定义键的信息。

#### `Function` 格式规范
函数可以用 `function fn(x, y) { /*这里是函数的主体*/ }` 或 `(x, y) => { /*这里是函数的主体*/ }` 的格式定义。
前者叫做具名函数。`fn` 是函数的名字，如果省略名字，则叫做匿名函数。
后者叫做箭头函数，箭头函数一定是匿名函数。
箭头函数如果只有一个参数，可以省略参数列表中的括号。

定义函数时，可以同时声明参数及返回值的类型。
如 `function fn(x: number, y: number): number { /*这里是函数的主体*/ }` 或 (x: number, y: number) => { /*这里是函数的主体*/ }

> 提示：使用箭头函数时，无法声明返回值的类型。

定义函数时，可以同时定义默认参数及默认值。
如 `function fn(x: number, y?: number) { /*这里是函数的主体*/ }`。
或 `function fn(x: number, y: number = 1) { /*这里是函数的主体*/ }`。

### `Function` 支持的运算
函数支持调用运算：`()`。

如调用名为 `fn`、类型为 `(x: number, y: number) => boolean` 的函数时，需要提供对应数量其类型一致的参数值：`fn(1, 2)`。
函数执行会后返回一个布尔值，这个布尔值可以继续参与计算：`fn(1, 2) && false`。

定义函数、表示函数类型时，需要书写参数的名字和类型，称为形参(parameter)。
而调用执行函数时，则需要书写真正的参数值，称为实参(argument)。

调用名为 `fn`、类型为 `(x: number, y?: number) => boolean` 的函数时，可以不提供形参 `y` 的实参，即 `fn(1)`，其等效于 `fn(1, undefined)`。

> 练习: 设计一个用于计算两个数最大值的函数类型。
