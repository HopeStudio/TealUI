function initSpeedMatch(e,t,n){initIFrame(current=compile(e,t,n)),initTable(current)}function openTestCase(e){stopSpeedMatch(),defaultOptions.rootPath=(e.match(/[\S\s]*\//)||[""])[0],appendScript(document,e)}function startSpeedMatch(e,t){if(current){var n=current[0].length,r=current.length-1,a=current.options.timeout;current.timer=setInterval(function(){if(!(current.loadingCount&&a-- >0))if(t<n)testOne(e,t),t++;else{if(updateMatches(e),++e==r)return sum(),stopSpeedMatch();t=1}},10)}}function stopSpeedMatch(){current&&clearInterval(current.timer)}function compile(e,t,n){var r=[[{text:Lang.cases}]],a={},o=[{text:Lang.sum}];r.options={},n=n||r.options;for(var c in defaultOptions)r.options[c]=c in n?n[c]:defaultOptions[c];for(var i in e)a[i]=r[0].length,r[0].push({text:i,cfg:e[i]}),o.push({text:i,result:NaN});for(var l in t){var s=t[l],u=[{text:l}];if("-"!==s&&s!==undefined){for(var i in s){var d=a[i];d>0&&(u[d]={text:s[i]})}s.time&&(u[0].time=s.time),r.push(u)}else r.push(u)}return r.push(o),r}function initIFrame(e){var t=e[0],n=document.getElementById("frames");emptyNode(n),e.loadingCount=0,t.forEach(function(t,r){function a(){var n=c.shift();(n=appendScript(o.contentWindow.document,n))[-[1]?"onload":"onreadystatechange"]=function(){"loading"!==n.readyState&&(e.loadingCount--,c.length?a():t.init&&t.init(o.contentWindow))}}if(0!=r){var o=t.iframe=document.createElement("iframe"),c="string"==typeof(t=t.cfg).js?[t.js]:t.js?t.js.slice(0):[];e.loadingCount+=1+(c?c.length:0),o.onload=function(){c.length&&a(),e.loadingCount--},o.src=e.options.rootPath+(t.html||e.options.html),n.appendChild(o)}})}function initTable(e){var t,n,r=document.getElementById("testcases");emptyNode(r),r=r.appendChild(document.createElement("tbody")),e.forEach(function(a,o){t=document.createElement("tr"),0===o||e.length===o+1?a.forEach(function(e,r){(n=document.createElement("th")).innerHTML=htmlEncode(e.text),t.appendChild(n)}):1===a.length?((n=document.createElement("th")).colSpan=e[0].length,n.innerHTML=htmlEncode(a[0].text),n.className="testcase",t.appendChild(n)):a.forEach(function(r,a){r&&(n=document.createElement("td"),0===a?(n.innerHTML=htmlEncode(r.text),n.className="testcase",n.ondblclick=onRowDblClick):(n.title=r.text,n.ondblclick=onCellDblClick,n.innerHTML=htmlEncode(eclipse(r.text,e.options.eclipseLength))),t.appendChild(n))}),r.appendChild(t)})}function emptyNode(e){for(;e.lastChild;)e.removeChild(e.lastChild)}function appendScript(e,t){var n=e.createElement("script");return n.type="text/javascript",n.src=t,(e.getElementsByTagName("head")[0]||e).appendChild(n),n}function testOne(e,t){var n=current[e];if(n&&(n=n[t])&&"-"!==n.text){var r=current[e][0].time||current.options.time,a=current[0][t].iframe;try{a.contentWindow.eval("var __timer = new Date(), __times = "+r+"; while(__times--){"+n.text+"} __timer = new Date() - __timer;"),r=a.contentWindow.__timer}catch(c){r=c}var o=document.getElementById("testcases").rows[e].cells[t];o.innerHTML='<span class="time">'+r+"</span> |"+htmlEncode(eclipse(n.text,current.options.eclipseLength)),"number"!=typeof r?o.className="error":n.result=r}}function eclipse(e,t){return e.length>t?e.substr(0,t)+"...":e}function htmlEncode(e){return e&&e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r?\n/g,"<br>").replace(/ /g,"&nbsp;")}function onCellDblClick(e){for(var t=(e=e||window.event).target||e.srcElement;"TD"!=t.tagName;)t=t.parentNode;testOne(t.parentNode.rowIndex,t.cellIndex),updateMatches(t.parentNode.rowIndex)}function onRowDblClick(e){for(var t=(e=e||window.event).target||e.srcElement;"TR"!=t.tagName;)t=t.parentNode;for(var n=1;n<current[0].length;n++)testOne(t.rowIndex,n);updateMatches(t.rowIndex)}function updateMatches(e){if(current[e]){for(var t=current[e],n=-Infinity,r=Infinity,a=[],o=[],c=document.getElementById("testcases").rows[e].cells,i=1;i<t.length;i++){"error"!==c[i].className&&(c[i].className="");var l=t[i].result;"number"==typeof l&&(c[i].className="normal",l>n?(a[0]=i,a.length=1,n=l):l==n&&a.push(i),l<r?(o[0]=i,o.length=1,r=l):l==r&&o.push(i))}a.forEach(function(e){c[e].className="worst"}),o.forEach(function(e){c[e].className="best"})}}function sum(){for(var e=1,t=current.length-1,n=document.getElementById("testcases").rows[t].cells,r=current[t];e<current[0].length;e++){r[e]=0;for(var a=1;a<t;a++)current[a][e]&&"number"==typeof current[a][e].result&&(r[e]+=current[a][e].result);n[e].innerHTML=current[0][e].text+" - "+r[e]}updateMatches(t)}function disableUrl(){document.getElementById("openUrl").style.display="none"}var current=null,Lang={cases:"cases",sum:"total"},defaultOptions={time:1e3,rootPath:"",html:"testcase.html",eclipseLength:100,timeout:1e3};location.search&&(window.onload=function(){var e=location.search.substr(1);e.indexOf("&disableUrl=false")>=0?e=e.replace("&disableUrl=false",""):disableUrl(),document.getElementById("url").value=e,openTestCase(e)}),Array.prototype.forEach=Array.prototype.forEach||function(e,t){for(var n=0;n<this.length;n++)e.call(t,this[n],n,this)};