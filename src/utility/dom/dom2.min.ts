// #todo

function Dom(n,t){return n=n||0,typeof n=="string"?/^</.test(n)?Dom.parse(n,t):Dom.find(n,t):n instanceof Dom?n:typeof n=="function"?Dom.ready(n,t):new Dom.List(n)}typeof include=="function"&&include("../lang/html5");Dom.List=function(n){var t=this,i,r;if(n.nodeType||n.document)t[t.length++]=n;else for(i=0;r=n[i];i++)t[t.length++]=r};Dom.find=function(n,t){return typeof console=="object"&&console.assert(typeof n=="string","Dom.find(selector: 必须是字符串, [context])"),typeof console=="object"&&console.assert(!t||t.querySelectorAll,"Dom.find(selector, [context: 必须是节点])"),new Dom.List((t||document).querySelectorAll(n))};Dom.parse=function(n,t){var i,r,u,f;if(typeof n=="string"){t=t?t.ownerDocument||t:document;typeof console=="object"&&console.assert(t.createElement,"Dom.parse(selector, [context: 必须是文档])");i=Dom._parseFix;i||(Dom._parseFix=i={option:[1,"<select multiple='multiple'>","<\/select>"],legend:[1,"<fieldset>","<\/fieldset>"],area:[1,"<map>","<\/map>"],param:[1,"<object>","<\/object>"],thead:[1,"<table>","<\/table>"],tr:[2,"<table><tbody>","<\/tbody><\/table>"],col:[2,"<table><tbody><\/tbody><colgroup>","<\/colgroup><\/table>"],td:[3,"<table><tbody><tr>","<\/tr><\/tbody><\/table>"]},i.optgroup=i.option,i.tbody=i.tfoot=i.colgroup=i.caption=i.thead,i.th=i.td,Dom._parseContainer=t.createElement("div"));r=/^<([!\w:]+)/.exec(n);r=r&&i[r[1].toLowerCase()];u=t===document?Dom._parseContainer:t.createElement("div");/*@cc_on if(!+"\v1"&&(r=r||[1,"$<div>","<\/div>"],t.createFragment)){var e=t.createFragment();e.appendChild(u)}@*/if(r)for(u.innerHTML=r[1]+n+r[2],f=r[0];f--;)u=u.lastChild;else u.innerHTML=n;n=u.childNodes}return new Dom.List(n)};Dom.ready=function(n,t){if(typeof console=="object"&&console.assert(n instanceof Function,"Dom.ready(callback: 必须是函数, [context])"),typeof console=="object"&&console.assert(!t||t.createElement,"Dom.ready(callback, [context: 必须是文档])"),t=t||document,/complete|loaded|interactive/.test(t.readyState)&&t.body)n.call(t);else{/*@ if(!+"\v1")return setTimeout(function(){Dom.ready(n,t)},14)@*/;t.addEventListener("DOMContentLoaded",n,!1)}};Dom.data=function(n,t){typeof console=="object"&&console.assert(n,"Dom.data(elem: 不能为空, fieldName)");var i=Dom._datas||(Dom._datas={}),r=n.__dataId__||(n.__dataId__=Dom._dataId=Dom._dataId+1||1);return i=i[r]||(i[r]={}),i[t]||(i[t]={})};Dom.matches=function(n,t){var r,u,i;if(typeof console=="object"&&console.assert(n,"Dom.matches(node: 不能为空, selector)"),typeof console=="object"&&console.assert(typeof t=="string","Dom.matches(node, selector: 必须是字符串)"),n.nodeType!==1)return!1;if(r=n.webkitMatchesSelector||n.msMatchesSelector||n.mozMatchesSelector||n.oMatchesSelector||n.matchesSelector,r)return r.call(n,t);u=n.parentNode;i=!u&&n.ownerDocument.body;i&&i.appendChild(n);try{return~Array.prototype.indexOf.call(Dom.find(t,u),n)}finally{i&&i.removeChild(n)}};Dom.contains=function(n,t){if(typeof console=="object"&&console.assert(n,"Dom.contains(node: 必须是节点, child)"),typeof console=="object"&&console.assert(!t||t.parentNode,"Dom.contains(node, child: 必须是节点)"),n.contains)return n.contains(t);for(;t;t=t.parentNode)if(t===n)return!0;return!1};Dom.closest=function(n,t,i){while(n&&n!==i&&!Dom.matches(n,t))n=n.parentNode;return n===i?null:n};Dom.vendor=function(n,t){var i,r;if(typeof console=="object"&&console.assert(n&&n.style,"Dom.vendor(elem: 必须是元素, cssPropertyName)"),typeof console=="object"&&console.assert(typeof t=="string","Dom.vendor(elem, cssPropertyName: 必须是字符串)"),!(t in n.style)){i=t.charAt(0).toUpperCase()+t.slice(1);for(r in{webkit:1,Moz:1,ms:1,O:1})if(r+i in n.style)return r+i}return t};Dom.css=function(n,t,i){typeof console=="object"&&console.assert(n&&n.style,"Dom.css(elem: 必须是元素, cssPropertyName, [value])");typeof console=="object"&&console.assert(!/-/.test(t),"Dom.css(elem, cssPropertyName: CSS 属性名必须使用骆驼规则(如将 font-size 改成 fontSize), [value])");/*@ if(!+"\v1"){Dom._styleFix||(Dom._styleFix={height:{get:function(n){return n.offsetHeight===0?"auto":n.offsetHeight-Dom.calc(n,"borderLeftWidth+borderRightWidth+paddingLeft+paddingRight")+"px"}},width:{get:function(n){return n.offsetWidth===0?"auto":n.offsetWidth-Dom.calc(n,"borderTopWidth+borderBottomWidth+paddingLeft+paddingRight")+"px"}},cssFloat:{get:function(n){return Dom(n).css("styleFloat")},set:function(n,t){return Dom(n).css("styleFloat",t)}},opacity:{rOpacity:/opacity=([^)]*)/,get:function(n){return this.rOpacity.test(n.currentStyle.filter)?parseInt(RegExp.$1)/100+"":"1"},set:function(n,t){t=t||t===0?"opacity="+t*100:"";n.style.zoom=1;var i=n.currentStyle.filter;n.style.filter=this.rOpacity.test(i)?i.replace(this.rOpacity,t):i+" alpha("+t+")"}}});var u=Dom._styleFix[t]||0,r;if(i===undefined){if(u.get)return u.get(n);if(r=n.currentStyle[t],/^-?\d/.test(r)&&!/^-?\d+(?:px)?$/i.test(r)){var f=n.style,e=f.left,o=n.runtimeStyle.left;n.runtimeStyle.left=n.currentStyle.left;f.left=t==="fontSize"?"1em":r||0;r=f.pixelLeft+"px";f.left=e;n.runtimeStyle.left=o}return r}u.set&&u.set(n,i)}@*/if(t=Dom.vendor(n,t),i===undefined)return n.ownerDocument.defaultView.getComputedStyle(n,null)[t];i&&typeof i=="number"&&!/^(columnCount|fillOpacity|flexGrow|flexShrink|fontWeight|lineHeight|opacity|order|orphans|widows|zIndex|zoom)$/.test(t)&&(i+="px");n.style[t]=i};Dom.calc=function(elem,expression){typeof console=="object"&&console.assert(elem&&elem.style,"Dom.calc(elem: 必须是元素, expression)");typeof console=="object"&&console.assert(typeof expression=="string","Dom.calc(elem, expression: 必须是字符串)");/*@ if(!+"\v1")return eval(expression.replace(/\w+/g,'(parseFloat(Dom.css(elem, "$1")) || 0)'))@*/;var computedStyle=elem.ownerDocument.defaultView.getComputedStyle(elem,null);return eval(expression.replace(/(\w+)/g,"(parseFloat(computedStyle['$1'])||0)"))};Dom.List.prototype=Dom.prototype={length:0,add:function(n){return n&&Dom.List.call(this,n),this},each:function(n,t){typeof console=="object"&&console.assert(n instanceof Function,"dom.each(callback: 必须是函数, [scope])");for(var i=0,r;(r=this[i])&&n.call(t,r,i,this)!==!1;i++);return this},map:function(n,t){var r,i,u;for(typeof console=="object"&&console.assert(n instanceof Function,"dom.map(callback: 必须是函数, [scope])"),r=Dom(),i=0;u=this[i];i++)r.add(n.call(t,u,i,this));return r},filter:function(n,t,i){i=i||!1;var r=this;return n?r.map(function(u,f){return(n.constructor===Function?!!n.call(t,u,f,r):Dom.matches(u,n))!==i&&u}):r},not:function(n,t){return this.filter(n,t,!0)},valueOf:function(){return this.length?this:null},on:function(n,t,i,r){var u=this,e=Dom._eventFix||(Dom._eventFix=function(n){function f(n,t){return t.type.length>9||!Dom.contains(n,t.relatedTarget)}var t={mouseenter:{delegate:"mouseover",filter:f},mouseleave:{delegate:"mouseout",filter:f},focus:{delegate:"focusin"},blur:{delegate:"focusout"},native_click:{bind:"click"},native_mousedown:{bind:"mousedown"},native_mouseup:{bind:"mouseup"},native_mousemove:{bind:"mousemove"}};if(!("onfocusin"in n)){function e(n){n.addEventListener(bind,this.bind,!0)}function o(n){n.addEventListener(bind,this.bind,!0)}t.focusin={bind:"focus",add:e,remove:o};t.focusout={bind:"blur",add:e,remove:o}}if("onmousewheel"in n||(t.mousewheel={bind:"DOMMouseScroll",filter:function(n,t){t.wheelDelta=-(t.detail||0)/3}}),window.TouchEvent){function i(n,t){t.pageX||t.pageY||!(t.changedTouches||0).length||(t.__defineGetter__("pageX",function(){return this.changedTouches[0].pageX}),t.__defineGetter__("pageY",function(){return this.changedTouches[0].pageY}),t.__defineGetter__("clientX",function(){return this.changedTouches[0].clientX}),t.__defineGetter__("clientY",function(){return this.changedTouches[0].clientY}),t.__defineGetter__("which",function(){return 1}))}function r(n,t,i){var r=0;n.addEventListener(this.bind,i.proxy1=function(n){return r=1,i.call(this,n)},!1);n.addEventListener(t,i.proxy2=function(n){if(r)r=0;else return i.call(this,n)},!1)}function u(n,t,i){n.removeEventListener(this.bind,i.proxy1,!1);n.removeEventListener(t,i.proxy2,!1)}t.mousedown={bind:"touchstart",filter:i,add:r,remove:u};t.mousemove={bind:"touchmove",filter:i,add:r,remove:u};t.mouseup={bind:"touchend",filter:i,add:r,remove:u};t.click={filter:i,add:function(n,t,i){var r=0;n.addEventListener("touchstart",i.proxy1=function(n){n.changedTouches.length===1&&(r=[n.changedTouches[0].pageX,n.changedTouches[0].pageY])},!1);n.addEventListener("touchend",i.proxy2=function(t){if(t.changedTouches.length===1&&r&&Math.pow(t.changedTouches[0].pageX-r[0],2)+Math.pow(t.changedTouches[0].pageY-r[1],2)<25)return r=2,i.call(n,t)},!1);n.addEventListener(t,i.proxy3=function(n){if(r===2)r=0;else return r=0,i.call(this,n)},!1)},remove:function(n,t,i){n.removeEventListener("touchstart",i.proxy1,!1);n.removeEventListener("touchend",i.proxy2,!1);n.removeEventListener(t,i.proxy3,!1)}}}return t}(Document.prototype)),f;if(n&&n.constructor===Object){for(i in n){f=/^\w+/.exec(i)||[i];u.on(f[0],key.slice(f[0].length),n[i],t)}return u}return typeof console=="object"&&console.assert(typeof t=="string"||t instanceof Function,"dom.on(eventName, [delegateSelector: 必须是字符串或函数], eventListener, [scope])"),t.constructor!==String&&(r=i,i=t,t=""),typeof console=="object"&&console.assert(i instanceof Function,"dom.on(eventName, [delegateSelector], eventListener: 必须是函数, [scope])"),u.each(function(u){var s=Dom.data(u,"events"),h=s[n]||(s[n]=[]),o=i,f=e[n]||0;(t||r||f.filter||h.indexOf(i)>=0)&&(o=function(n){var e=u;if(!t||(e=Dom.closest(n.target,t,this),e))return!f.filter||f.filter(e,n)!==!1?i.call(r||e,n):void 0},o.orignal=i);t&&f.delegate&&(f=f[n=f.delegate]||0);f.add?f.add(u,n,o):u.addEventListener(f.bind||n,o,!1);h.push(o)})},off:function(n,t,i){var r=this;return typeof console=="object"&&console.assert(!t||typeof t=="string"||t instanceof Function,"dom.off(eventName, [delegateSelector: 必须是字符串或函数], eventListener)"),t!=null&&t.constructor!==String&&(i=t,t=""),r.each(function(u){var f=Dom.data(u,"events")[n],s,e,o;if(f){if(!i){for(s=0;s<f.length;s++)r.off(n,f[s]);return}if(e=f.indexOf(i),e<0)for(e=f.length;e--&&f[e].orignal!==i;);if(~e&&(i=f[e],f.splice(e,1),f.length||delete Dom.data(u,"events")[n]),!Dom._eventFix)r.on({});o=Dom._eventFix[n]||0;o.remove?o.remove(u,n,i):u.removeEventListener((t?o.delegate:o.bind)||n,i,!1)}})},trigger:function(n,t){return this.each(function(i){var r=Dom.data(i,"events")[n],u;if(r)for(t=t||{},t.type=n,t.target=i,r=r.slice(0),u=0;u<r.length;u++)r[u].call(i,t)})},constructor:Dom,push:[].push,indexOf:[].indexOf,slice:[].slice,splice:[].splice};Dom.prototype.each.call(["click","focus","blur"],function(n){Dom.prototype[n]=function(t){return t!==undefined?this.on(n,t):this.each(function(t){t[n]?t[n]():Dom(t).trigger(n)})}});var $=$||Dom;$.fn&&($.prototype=$.fn);