<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>DOM 基础操作</title>
    <meta name="module-info" content="parent-title=DOM, parent-order=lang, order=^">
    <meta name="author" content="xuld@vip.qq.com">
    <meta name="description" content="提供统一的、快速的 DOM 操作方法。">

    <!-- 以下是本组件的全部源码 -->
    <script type="text/javascript" src="../../utility/lang/html5.js"></script>
    <script type="text/javascript" src="../../utility/dom/base.js"></script>
</head>
<body>
    <!-- 以下代码仅用于文档演示 -->
    <script type="text/javascript" src="../../../assets/doc.js"></script>

    <div id="elem" class="doc-box" style="min-height: 0; height: 100px;"><a>#elem</a></div>

    <h2>API <small>(源码: <a href="../../utility/dom/base.js" target="_blank">utility/dom/base.js</a>)</small></h2>
    
    <h3>集合操作</h3>
    <table class="doc-table">
        <tr>
            <th>API</th>
            <th>描述</th>
            <th>示例</th>
        </tr>
        <tr>
            <td><code>$/Dom</code></td>
            <td>CSS 选择器/生成节点/Dom Ready</td>
            <td>
                <pre>$(".doc-box")</pre>
                <pre>$("&lt;a>你好&lt;/a>")</pre>
                <pre>$(function(){ alert("DOM ready") })</pre>
            </td>
        </tr>
        <tr>
            <td><code><em>dom</em>.add</code></td>
            <td>添加</td>
            <td><pre>$("#elem").add(document.body)</pre></td>
        </tr>
        <tr>
            <td><code><em>dom</em>.each</code></td>
            <td>遍历</td>
            <td><pre>$("#elem").each(function(node){alert(node.innerHTML)});</pre></td>
        </tr>
        <tr>
            <td><code><em>dom</em>.map</code></td>
            <td>匹配</td>
            <td><pre>$("#elem").map(function(node){return node.firstChild});</pre></td>
        </tr>
        <tr>
            <td><code><em>dom</em>.filter</code></td>
            <td>过滤</td>
            <td><pre>$("#elem").filter('div');</pre></td>
        </tr>
        <tr>
            <td><code><em>dom</em>.not</code></td>
            <td>排除</td>
            <td><pre>$("#elem").not('div');</pre></td>
        </tr>
    </table>

    <h3>选择器</h3>
    <table class="doc-table">
        <tr>
            <th>API</th>
            <th>描述</th>
            <th>示例</th>
        </tr>
        <tr>
            <td><code><em>dom</em>.find</code></td>
            <td>查找子节点</td>
            <td><pre>$("#elem").find("div")</pre></td>
        </tr>
        <tr>
            <td><code><em>dom</em>.is</code></td>
            <td>判断是否匹配</td>
            <td><pre>$("#elem").is("a")</pre></td>
        </tr>
    </table>

    <h3>事件</h3>
    <table class="doc-table">
        <tr>
            <th>API</th>
            <th>描述</th>
            <th>示例</th>
        </tr>
        <tr>
            <td><code><em>dom</em>.on</code></td>
            <td>绑定事件</td>
            <td class="doc">
                <h5>普通绑定</h5>
                <pre>$("#elem").on('click', function(){ alert("点击事件") });</pre>
                <h5>委托事件</h5>
                <pre>$("#elem").on('mouseenter', 'a', function(e){ this.firstChild.innerHTML = e.pageX; });</pre>
                <blockquote><h4>触屏事件</h4>TealUI.Dom 会自动将 <code>click</code>/<code>mouse</code> 事件绑定为相应的 <code>touch</code> 事件，以增加触屏设备上相应事件的响应速度。</blockquote>
                <blockquote><h4>IE 特有事件</h4>TealUI.Dom 支持自定义事件，并内置了 <code>mousewheel</code>/<code>mouseenter</code>/<code>mouseleave</code>/<code>focusin</code>/<code>foucsout</code> 等 IE 特定事件支持。</blockquote>
            </td>
        </tr>
        <tr>
            <td><code><em>dom</em>.off</code></td>
            <td>解绑事件</td>
            <td><pre>$("#elem").off('click', function(){ alert("点击事件2") })</pre></td>
        </tr>
        <tr>
            <td><code><em>dom</em>.trigger</code></td>
            <td>手动触发事件</td>
            <td><pre>$("#elem").trigger('click')</pre></td>
        </tr>
    </table>

    <h3>遍历</h3>
    <table class="doc-table">
        <tr>
            <th>API</th>
            <th>描述</th>
            <th>示例</th>
        </tr>
        <tr>
            <td><code><em>dom</em>.closest</code></td>
            <td>最近父节点</td>
            <td><pre>$("#elem").closest("body")</pre></td>
        </tr>
        <tr>
            <td><code><em>dom</em>.parent</code></td>
            <td>获取父节点</td>
            <td><pre>$("#elem").parent()</pre></td>
        </tr>
        <tr>
            <td><code><em>dom</em>.first</code></td>
            <td>第一个子节点</td>
            <td><pre>$("#elem").first()</pre></td>
        </tr>
        <tr>
            <td><code><em>dom</em>.last</code></td>
            <td>最后一个子节点</td>
            <td><pre>$("#elem").last()</pre></td>
        </tr>
        <tr>
            <td><code><em>dom</em>.next</code></td>
            <td>下一兄弟节点</td>
            <td><pre>$("#elem").next()</pre></td>
        </tr>
        <tr>
            <td><code><em>dom</em>.prev</code></td>
            <td>上一兄弟节点</td>
            <td><pre>$("#elem").prev()</pre></td>
        </tr>
        <tr>
            <td><code><em>dom</em>.children</code></td>
            <td>所有子节点</td>
            <td><pre>$("#elem").children()</pre></td>
        </tr>
        <tr>
            <td><code><em>dom</em>.index</code></td>
            <td>获取节点索引</td>
            <td><pre>$("#elem").index()</pre></td>
        </tr>
    </table>

    <h3>增删</h3>
    <table class="doc-table">
        <tr>
            <th>API</th>
            <th>描述</th>
            <th>示例</th>
        </tr>
        <tr>
            <td><code><em>dom</em>.append</code></td>
            <td>插到末尾</td>
            <td><pre>$("#elem").append("append")</pre></td>
        </tr>
        <tr>
            <td><code><em>dom</em>.prepend</code></td>
            <td>插到前尾</td>
            <td><pre>$("#elem").prepend("prepend")</pre></td>
        </tr>
        <tr>
            <td><code><em>dom</em>.after</code></td>
            <td>插到后面</td>
            <td><pre>$("#elem").after("after")</pre></td>
        </tr>
        <tr>
            <td><code><em>dom</em>.before</code></td>
            <td>插到前面</td>
            <td><pre>$("#elem").before("before")</pre></td>
        </tr>
        <tr>
            <td><code><em>dom</em>.remove</code></td>
            <td>删除节点</td>
            <td><pre>$("#elem").remove()</pre></td>
        </tr>
        <tr>
            <td><code><em>dom</em>.clone</code></td>
            <td>复制节点</td>
            <td><pre>$("#elem").clone()</pre></td>
        </tr>
    </table>

    <h3>CSS类</h3>
    <table class="doc-table">
        <tr>
            <th>API</th>
            <th>描述</th>
            <th>示例</th>
        </tr>
        <tr>
            <td><code><em>dom</em>.hasClass</code></td>
            <td>判断类</td>
            <td><pre>$("#elem").hasClass("light")</pre></td>
        </tr>
        <tr>
            <td><code><em>dom</em>.addClass</code></td>
            <td>添加类</td>
            <td><pre>$("#elem").addClass("light")</pre></td>
        </tr>
        <tr>
            <td><code><em>dom</em>.removeClass</code></td>
            <td>删除类</td>
            <td><pre>$("#elem").removeClass("light")</pre></td>
        </tr>
        <tr>
            <td><code><em>dom</em>.toggleClass</code></td>
            <td>切换类</td>
            <td><pre>$("#elem").toggleClass("light")</pre></td>
        </tr>
    </table>

    <h3>样式</h3>
    <table class="doc-table">
        <tr>
            <th>API</th>
            <th>描述</th>
            <th>示例</th>
        </tr>
        <tr>
            <td><code><em>dom</em>.css</code></td>
            <td>读写样式</td>
            <td>
                <pre>$("#elem").css("fontSize");</pre>
                <pre>$("#elem").css("fontSize", "12px");</pre>
                <blockquote><h4>IE Transform</h4>可使用 <a href="http://www.useragentman.com/IETransformsTranslator/">IE Transforms Translator</a> 工具实现 IE6-9 Transform 效果。</blockquote>
            </td>
        </tr>
    </table>

    <h3>属性</h3>
    <table class="doc-table">
        <tr>
            <th>API</th>
            <th>描述</th>
            <th>示例</th>
        </tr>
        <tr>
            <td><code><em>dom</em>.attr</code></td>
            <td>读写属性</td>
            <td>
                <pre>$("#elem").attr("className");</pre>
                <pre>$("#elem").attr("className", "doc-doc"); // 设置为 null 表示删除。</pre>
            </td>
        </tr>
        <tr>
            <td><code><em>dom</em>.text</code></td>
            <td>读写文本</td>
            <td>
                <pre>$("#elem").text();</pre>
                <pre>$("#elem").text("a");</pre>
            </td>
        </tr>
        <tr>
            <td><code><em>dom</em>.html</code></td>
            <td>读写 HTML</td>
            <td>
                <pre>$("#elem").html();</pre>
                <pre>$("#elem").html("&lt;em>a&lt;/em>");</pre>
            </td>
        </tr>
    </table>

    <h3>尺寸</h3>
    <table class="doc-table">
        <tr>
            <th>API</th>
            <th>描述</th>
            <th>示例</th>
        </tr>
        <tr>
            <td><code><em>dom</em>.rect</code></td>
            <td>读写大小和位置</td>
            <td>
                <pre>$("#elem").rect();</pre>
                <pre>$("#elem").rect({width:200, height:400});</pre>
                <pre>$("#elem").rect({left: 30});</pre>
            </td>
        </tr>
        <tr>
            <td><code><em>dom</em>.offset</code></td>
            <td>获取相对位置</td>
            <td><pre>$("#elem").offset()</pre></td>
        </tr>
        <tr>
            <td><code><em>dom</em>.offsetParent</code></td>
            <td>获取相对偏移节点</td>
            <td><pre>$("#elem").offsetParent()</pre></td>
        </tr>
        <tr>
            <td><code><em>dom</em>.scroll</code></td>
            <td>读写滚动位置</td>
            <td>
                <pre>$("#elem").scroll();</pre>
                <pre>$("#elem").scroll({left:100, top: 500});</pre>
            </td>
        </tr>
    </table>

    <h3>特效</h3>
    <table class="doc-table">
        <tr>
            <th>API</th>
            <th>描述</th>
            <th>示例</th>
        </tr>
        <tr>
            <td><code><em>dom</em>.animate</code></td>
            <td>自定义特效</td>
            <td>
                <pre>$("#elem").animate('auto', {height: '400px'});</pre>
                <pre>$("#elem").animate({transform: 'rotate(45deg)'});</pre>
            </td>
        </tr>
        <tr>
            <td><code><em>dom</em>.isHidden</code></td>
            <td>判断是否隐藏</td>
            <td><pre>$("#elem").isHidden();</pre></td>
        </tr>
        <tr>
            <td><code><em>dom</em>.show</code></td>
            <td>显示</td>
            <td><pre>$("#elem").show();</pre></td>
        </tr>
        <tr>
            <td><code><em>dom</em>.hide</code></td>
            <td>隐藏</td>
            <td><pre>$("#elem").hide();</pre></td>
        </tr>
        <tr>
            <td><code><em>dom</em>.toggle</code></td>
            <td>切换显示</td>
            <td class="doc">
                <h5>折叠/展开</h5>
                <pre>$("#elem").toggle('height');</pre>

                <h5>深入/淡出</h5>
                <pre>$("#elem").toggle('opacity');</pre>

                <h5>缩小/放大</h5>
                <pre>$("#elem").toggle('scale');</pre>
            </td>
        </tr>
    </table>

    <h3>其它底层函数</h3>
    <table class="doc-table">
        <tr>
            <th>API</th>
            <th>描述</th>
            <th>示例</th>
        </tr>
        <tr>
            <td><code>Dom.data</code></td>
            <td>获取数据</td>
            <td><pre>Dom.data(document.getElementById('elem'))</pre></td>
        </tr>
        <tr>
            <td><code>Dom.closest</code></td>
            <td>获取最近节点</td>
            <td><pre>Dom.closest(document.getElementById('elem'), 'body')</pre></td>
        </tr>
        <tr>
            <td><code>Dom.vendor</code></td>
            <td>获取 CSS 属性前缀</td>
            <td><pre>Dom.vendor(document.getElementById('elem'), 'transform')</pre></td>
        </tr>
        <tr>
            <td><code>Dom.css</code></td>
            <td>获取当前 CSS</td>
            <td><pre>Dom.css(document.getElementById('elem'), 'fontSize')</pre></td>
        </tr>
        <tr>
            <td><code>Dom.calc</code></td>
            <td>计算 CSS 表达式</td>
            <td><pre>Dom.calc(document.getElementById('elem'), 'fontSize+lineHeight')</pre></td>
        </tr>
    </table>

    <h2>jQuery 那些事儿</h2>
    <p>jQuery 已成为前端主流，不基于 jQuery 的 UI 库也逐渐被淘汰。这主要因为：</p>
    <ol>
        <li>jQuery 确实简化了前端开发，社区插件完备。</li>
        <li>众多前端开发只接受和熟悉 jQuery，一切基于 jQuery 更有安全感。</li>
    </ol>

    <p>然而，jQuery 对于组件开发却不是很好用</p>
    <ol>
        <li>开发组件需要大量计算，jQuery 的 API 返回字符串不利于计算。</li>
        <li>需要大量计算（比如拖动效果） 时，使用 jQuery 性能很差。</li>
        <li>jQuery 未提供组件开发常用 API，如 CSS3 动画、获取子节点、获取滚动位置。</li>
        <li>jQuery 体积太大，我们不希望用户为了用一个小小的组件而强迫引入整个 jQuery。</li>
        <li>基于 jQuery 开发组件反而增加了组件复杂度和代码量。</li>
    </ol>

    <p>因此 TealUI 不基于 jQuery，改用自己的 DOM 框架，我们称为 TealUI.Dom。</p>
    <ol>
        <li>TealUI.Dom 专为组件开发提供，减少组件代码量。（因此 TealUI 比其它 jQuery 插件形式的 UI 库更小）</li>
        <li>TealUI.Dom 功能和 jQuery 类似，但体积仅 jQuery 的 1/10。</li>
        <li>我们不希望 UI 组件强制用户使用 jQuery。特别随着 React 的流行，jQuery 已不是必须的。</li>
        <li>我们不阻止您继续使用 jQuery, 将 TealUI 和 jQuery/Zepto 同时使用完全没有问题。</li>
    </ol>

    <p>如果您支持体积更小的 TealUI.Dom，请注意以下问题：</p>
    <ol>
        <li>jQuery 为降低开发错误率，提供各种补丁，TealUI.Dom 则不会提供它们。比如获取 CSS float 属性值，熟悉 JS 的用户都知道直接获取 float 是不对的，应该改成 cssFloat，而 jQuery 为了照顾那些不清楚这些细节的用户，使用 <code>.css("float")</code> 和 <code>.css("cssFloat") </code> 都能正常获取。改成 TealUI.Dom 则只能使用后者。因此我们只建议基础较好的用户使用 TealUI.Dom。</li>
        <li>TealUI.Dom 大部分函数只能有固定传参方式。比如 <code>.css({fontSize: 14, color: 'red'})</code> 是不支持的，应该改成 <code>.css('fontSize', 14).css('color', 'red')</code></li>
        <li>部分 API 同名但功能不同。比如 <code>first</code> 在 jQuery 获取集合第一个元素，然并卵，所以在 TealUI.Dom 则是获取第一个元素的第一个子节点。其它的区别我们将在下表给出。</li>
    </ol>

    <table class="doc-fill">
        <tr>
            <th>API</th>
            <th>TealUI.Dom</th>
            <th>jQuery</th>
        </tr>
        <tr>
            <td>CSS 选择器</td>
            <td>完全基于浏览器，无额外功能。</td>
            <td>支持众多非标准选择器。</td>
        </tr>
        <tr>
            <td><code>.each()</code></td>
            <td>用法同标准数组的 forEach，当前元素是首参。</td>
            <td>当前元素是 this。</td>
        </tr>
        <tr>
            <td><code>.trigger()</code></td>
            <td>只触发手动绑定的 API，不支持冒泡。</td>
            <td>可触发原生事件，支持冒泡。</td>
        </tr>
        <tr>
            <td><code>.first()/.last()</code></td>
            <td>获取第/最后一个子节点。</td>
            <td>获取当前集合的第/最后一项。</td>
        </tr>
        <tr>
            <td><code>.index()</code></td>
            <td>获取节点在 DOM 树的索引。</td>
            <td>获取节点在数组本身的索引。</td>
        </tr>
        <tr>
            <td><code>.css()</code></td>
            <td>只支持骆驼规则写法。</td>
            <td>支持任意格式。</td>
        </tr>
        <tr>
            <td><code>.val()</code></td>
            <td>使用 <code>.text()</code> 代替。</td>
            <td></td>
        </tr>
        <tr>
            <td><code>.show()/.hide()</code></td>
            <td>通过参数可添加特效。</td>
            <td>无特效。</td>
        </tr>
        <tr>
            <td><code>.offset()</code></td>
            <td>返回相对路径，同 jQuery 的 <code>.position()</code>。</td>
            <td>返回绝对路径，同 TealUI.Dom 的 <code>.rect()</code>。</td>
        </tr>
    </table>

    <h2>TealUI.Dom 和 Zepto、jQuery 的特性比较</h2>

    <table class="doc-fill">
        <tr>
            <th>特性</th>
            <th>TealUI.Dom</th>
            <th>Zepto</th>
            <th>jQuery 2.x</th>
            <th>jQuery 1.x</th>
        </tr>
        <tr>
            <td>体积（压缩后）</td>
            <td>16k</td>
            <td>29k</td>
            <td>78k</td>
            <td>160k</td>
        </tr>
        <tr>
            <td>兼容性</td>
            <td>IE8+</td>
            <td>IE9+（仅手机）</td>
            <td>IE9+</td>
            <td>IE6+</td>
        </tr>
        <tr>
            <td>特效</td>
            <td>CSS3</td>
            <td>CSS3</td>
            <td>JS</td>
            <td>JS</td>
        </tr>
        <tr>
            <td>选择器</td>
            <td>原生</td>
            <td>原生</td>
            <td>扩展</td>
            <td>扩展</td>
        </tr>
        <tr>
            <td>触屏事件</td>
            <td>✔</td>
            <td>✔</td>
            <td>✖</td>
            <td>✖</td>
        </tr>
        <tr>
            <td>事件委托</td>
            <td>✔</td>
            <td>✔</td>
            <td>✔</td>
            <td>✔</td>
        </tr>
        <tr>
            <td>事件名空间</td>
            <td>✖</td>
            <td>✔</td>
            <td>✔</td>
            <td>✔</td>
        </tr>
        <tr>
            <td>CSS3前缀</td>
            <td>✔</td>
            <td>✖</td>
            <td>✔</td>
            <td>✔</td>
        </tr>
    </table>

</body>
</html>
